<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>a页面</title>
    </head>
    <body>
        <div id="app">
            <button class="open-btn">打开一个新窗口</button>
        </div>
    </body>
    <script>
        const openBtn = document.querySelector('.open-btn')
        openBtn.onclick = function () {
            /*
             * A 窗口的域名是<http://example.com:8080>，以下是 A 窗口的 script 标签下的代码：
             */

            var popup = window.open('http://192.168.2.57:8083/b.html')
            console.log('popup :>> ', popup)

            // 如果弹出框没有被阻止且加载完成

            // 这行语句没有发送信息出去，即使假设当前页面没有改变 location（因为 targetOrigin 设置不对）
            popup.postMessage(
                "The user is 'bob' and the password is 'secret'",
                'http://192.168.2.57:8082',
            )

            // 假设当前页面没有改变 location，这条语句会成功添加 message 到发送队列中去（targetOrigin 设置对了）
            popup.postMessage('hello there!', 'http://192.168.2.57:8082')

            function receiveMessage(event) {
                console.log('event-111 :>> ', event)
                // 我们能相信信息的发送者吗？(也许这个发送者和我们最初打开的不是同一个页面).
                if (event.origin !== 'http://example.org') return

                // event.source 是我们通过 window.open 打开的弹出页面 popup
                // event.data 是 popup 发送给当前页面的消息 "hi there yourself!  the secret response is: rheeeeet!"
            }
            window.addEventListener('message', receiveMessage, false)
        }
    </script>
</html>
