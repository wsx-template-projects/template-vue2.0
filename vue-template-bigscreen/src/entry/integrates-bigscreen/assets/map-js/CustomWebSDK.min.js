function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Custom=t()}})(function(){var t;return function(){function t(e,r,i){function n(s,a){if(!r[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=r[s]={exports:{}};e[s][0].call(u.exports,function(t){var r=e[s][1][t];return n(r||t)},u,u.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}return t}()({1:[function(t,e,r){"use strict";function i(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var i=r===e?0:4-r%4;return[r,i]}function n(t){var e=i(t),r=e[0],n=e[1];return 3*(r+n)/4-n}function o(t,e,r){return 3*(e+r)/4-r}function s(t){var e,r,n=i(t),s=n[0],a=n[1],l=new f(o(t,s,a)),h=0,u=a>0?s-4:s;for(r=0;r<u;r+=4)e=c[t.charCodeAt(r)]<<18|c[t.charCodeAt(r+1)]<<12|c[t.charCodeAt(r+2)]<<6|c[t.charCodeAt(r+3)],l[h++]=e>>16&255,l[h++]=e>>8&255,l[h++]=255&e;return 2===a&&(e=c[t.charCodeAt(r)]<<2|c[t.charCodeAt(r+1)]>>4,l[h++]=255&e),1===a&&(e=c[t.charCodeAt(r)]<<10|c[t.charCodeAt(r+1)]<<4|c[t.charCodeAt(r+2)]>>2,l[h++]=e>>8&255,l[h++]=255&e),l}function a(t){return u[t>>18&63]+u[t>>12&63]+u[t>>6&63]+u[63&t]}function l(t,e,r){for(var i,n=[],o=e;o<r;o+=3)i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),n.push(a(i));return n.join("")}function h(t){for(var e,r=t.length,i=r%3,n=[],o=16383,s=0,a=r-i;s<a;s+=o)n.push(l(t,s,s+o>a?a:s+o));return 1===i?(e=t[r-1],n.push(u[e>>2]+u[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],n.push(u[e>>10]+u[e>>4&63]+u[e<<2&63]+"=")),n.join("")}r.byteLength=n,r.toByteArray=s,r.fromByteArray=h;for(var u=[],c=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,y=p.length;d<y;++d)u[d]=p[d],c[p.charCodeAt(d)]=d;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],2:[function(t,e,r){(function(e){(function(){"use strict";function e(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}function i(t){if(t>Y)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=n.prototype,e}function n(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return o(t,e,r)}function o(t,e,r){if("string"==typeof t)return h(t,e);if(ArrayBuffer.isView(t))return u(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===t?"undefined":_typeof(t)));if(H(t,ArrayBuffer)||t&&H(t.buffer,ArrayBuffer))return c(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return n.from(i,e,r);var o=f(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return n.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===t?"undefined":_typeof(t)))}function s(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function a(t,e,r){return s(t),t<=0?i(t):void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)}function l(t){return s(t),i(t<0?0:0|p(t))}function h(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!n.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|y(t,e),o=i(r),s=o.write(t,e);return s!==r&&(o=o.slice(0,s)),o}function u(t){for(var e=t.length<0?0:0|p(t.length),r=i(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function c(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),i.__proto__=n.prototype,i}function f(t){if(n.isBuffer(t)){var e=0|p(t.length),r=i(e);return 0===r.length?r:(t.copy(r,0,0,e),r)}return void 0!==t.length?"number"!=typeof t.length||q(t.length)?i(0):u(t):"Buffer"===t.type&&Array.isArray(t.data)?u(t.data):void 0}function p(t){if(t>=Y)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Y.toString(16)+" bytes");return 0|t}function d(t){return+t!=t&&(t=0),n.alloc(+t)}function y(t,e){if(n.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||H(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+(void 0===t?"undefined":_typeof(t)));var r=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;for(var o=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return R(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(t).length;default:if(o)return i?-1:R(t).length;e=(""+e).toLowerCase(),o=!0}}function g(t,e,r){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,e>>>=0,r<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return F(this,e,r);case"ascii":return C(this,e,r);case"latin1":case"binary":return D(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function v(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function m(t,e,r,i,o){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,q(r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof e&&(e=n.from(e,i)),n.isBuffer(e))return 0===e.length?-1:x(t,e,r,i,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):x(t,[e],r,i,o);throw new TypeError("val must be string, number or Buffer")}function x(t,e,r,i,n){function o(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var s,a=1,l=t.length,h=e.length;if(void 0!==i&&(i=String(i).toLowerCase(),"ucs2"===i||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;a=2,l/=2,h/=2,r/=2}if(n){var u=-1;for(s=r;s<l;s++)if(o(t,s)===o(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===h)return u*a}else-1!==u&&(s-=s-u),u=-1}else for(r+h>l&&(r=l-h),s=r;s>=0;s--){for(var c=!0,f=0;f<h;f++)if(o(t,s+f)!==o(e,f)){c=!1;break}if(c)return s}return-1}function w(t,e,r,i){r=Number(r)||0;var n=t.length-r;i?(i=Number(i),i>n&&(i=n)):i=n;var o=e.length;i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(e.substr(2*s,2),16);if(q(a))return s;t[r+s]=a}return s}function b(t,e,r,i){return N(R(e,t.length-r),t,r,i)}function L(t,e,r,i){return N(j(e),t,r,i)}function _(t,e,r,i){return L(t,e,r,i)}function T(t,e,r,i){return N(V(e),t,r,i)}function S(t,e,r,i){return N(W(e,t.length-r),t,r,i)}function A(t,e,r){return 0===e&&r===t.length?Z.fromByteArray(t):Z.fromByteArray(t.slice(e,r))}function F(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var o,s,a,l,h=t[n],u=null,c=h>239?4:h>223?3:h>191?2:1;if(n+c<=r)switch(c){case 1:h<128&&(u=h);break;case 2:o=t[n+1],128==(192&o)&&(l=(31&h)<<6|63&o,l>127&&(u=l));break;case 3:o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&(l=(15&h)<<12|(63&o)<<6|63&s,l>2047&&(l<55296||l>57343)&&(u=l));break;case 4:o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&h)<<18|(63&o)<<12|(63&s)<<6|63&a,l>65535&&l<1114112&&(u=l))}null===u?(u=65533,c=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),n+=c}return I(i)}function I(t){var e=t.length;if(e<=J)return String.fromCharCode.apply(String,t);for(var r="",i=0;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=J));return r}function C(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function D(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function B(t,e,r){var i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var n="",o=e;o<r;++o)n+=O(t[o]);return n}function M(t,e,r){for(var i=t.slice(e,r),n="",o=0;o<i.length;o+=2)n+=String.fromCharCode(i[o]+256*i[o+1]);return n}function P(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function U(t,e,r,i,o,s){if(!n.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<s)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function z(t,e,r,i,n,o){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function E(t,e,r,i,n){return e=+e,r>>>=0,n||z(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(t,e,r,i,23,4),r+4}function G(t,e,r,i,n){return e=+e,r>>>=0,n||z(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(t,e,r,i,52,8),r+8}function k(t){if(t=t.split("=")[0],t=t.trim().replace(Q,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function O(t){return t<16?"0"+t.toString(16):t.toString(16)}function R(t,e){var r;e=e||1/0;for(var i=t.length,n=null,o=[],s=0;s<i;++s){if(r=t.charCodeAt(s),r>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&o.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function j(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function W(t,e){for(var r,i,n,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),i=r>>8,n=r%256,o.push(n),o.push(i);return o}function V(t){return Z.toByteArray(k(t))}function N(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function H(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function q(t){return t!=t}var Z=t("base64-js"),X=t("ieee754");r.Buffer=n,r.SlowBuffer=d,r.INSPECT_MAX_BYTES=50;var Y=2147483647;r.kMaxLength=Y,n.TYPED_ARRAY_SUPPORT=e(),n.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(n.prototype,"parent",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.buffer}}),Object.defineProperty(n.prototype,"offset",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&n[Symbol.species]===n&&Object.defineProperty(n,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),n.poolSize=8192,n.from=function(t,e,r){return o(t,e,r)},n.prototype.__proto__=Uint8Array.prototype,n.__proto__=Uint8Array,n.alloc=function(t,e,r){return a(t,e,r)},n.allocUnsafe=function(t){return l(t)},n.allocUnsafeSlow=function(t){return l(t)},n.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==n.prototype},n.compare=function(t,e){if(H(t,Uint8Array)&&(t=n.from(t,t.offset,t.byteLength)),H(e,Uint8Array)&&(e=n.from(e,e.offset,e.byteLength)),!n.isBuffer(t)||!n.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,i=e.length,o=0,s=Math.min(r,i);o<s;++o)if(t[o]!==e[o]){r=t[o],i=e[o];break}return r<i?-1:i<r?1:0},n.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return n.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=n.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var s=t[r];if(H(s,Uint8Array)&&(s=n.from(s)),!n.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i},n.byteLength=y,n.prototype._isBuffer=!0,n.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},n.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},n.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},n.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?F(this,0,t):g.apply(this,arguments)},n.prototype.toLocaleString=n.prototype.toString,n.prototype.equals=function(t){if(!n.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===n.compare(this,t)},n.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},n.prototype.compare=function(t,e,r,i,o){if(H(t,Uint8Array)&&(t=n.from(t,t.offset,t.byteLength)),!n.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+(void 0===t?"undefined":_typeof(t)));if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),e<0||r>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&e>=r)return 0;if(i>=o)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,o>>>=0,this===t)return 0;for(var s=o-i,a=r-e,l=Math.min(s,a),h=this.slice(i,o),u=t.slice(e,r),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],a=u[c];break}return s<a?-1:a<s?1:0},n.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},n.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},n.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)},n.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":return L(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return T(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var J=4096;n.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);var i=this.subarray(t,e);return i.__proto__=n.prototype,i},n.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var i=this[t],n=1,o=0;++o<e&&(n*=256);)i+=this[t+o]*n;return i},n.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},n.prototype.readUInt8=function(t,e){return t>>>=0,e||P(t,1,this.length),this[t]},n.prototype.readUInt16LE=function(t,e){return t>>>=0,e||P(t,2,this.length),this[t]|this[t+1]<<8},n.prototype.readUInt16BE=function(t,e){return t>>>=0,e||P(t,2,this.length),this[t]<<8|this[t+1]},n.prototype.readUInt32LE=function(t,e){return t>>>=0,e||P(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},n.prototype.readUInt32BE=function(t,e){return t>>>=0,e||P(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},n.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var i=this[t],n=1,o=0;++o<e&&(n*=256);)i+=this[t+o]*n;return n*=128,i>=n&&(i-=Math.pow(2,8*e)),i},n.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var i=e,n=1,o=this[t+--i];i>0&&(n*=256);)o+=this[t+--i]*n;return n*=128,o>=n&&(o-=Math.pow(2,8*e)),o},n.prototype.readInt8=function(t,e){return t>>>=0,e||P(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},n.prototype.readInt16LE=function(t,e){t>>>=0,e||P(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt16BE=function(t,e){t>>>=0,e||P(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt32LE=function(t,e){return t>>>=0,e||P(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},n.prototype.readInt32BE=function(t,e){return t>>>=0,e||P(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},n.prototype.readFloatLE=function(t,e){return t>>>=0,e||P(t,4,this.length),X.read(this,t,!0,23,4)},n.prototype.readFloatBE=function(t,e){return t>>>=0,e||P(t,4,this.length),X.read(this,t,!1,23,4)},n.prototype.readDoubleLE=function(t,e){return t>>>=0,e||P(t,8,this.length),X.read(this,t,!0,52,8)},n.prototype.readDoubleBE=function(t,e){return t>>>=0,e||P(t,8,this.length),X.read(this,t,!1,52,8)},n.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;U(this,t,e,r,n,0)}var o=1,s=0;for(this[e]=255&t;++s<r&&(o*=256);)this[e+s]=t/o&255;return e+r},n.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;U(this,t,e,r,n,0)}var o=r-1,s=1;for(this[e+o]=255&t;--o>=0&&(s*=256);)this[e+o]=t/s&255;return e+r},n.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,1,255,0),this[e]=255&t,e+1},n.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},n.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},n.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},n.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},n.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*r-1);U(this,t,e,r,n-1,-n)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},n.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*r-1);U(this,t,e,r,n-1,-n)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},n.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},n.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},n.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},n.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},n.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||U(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},n.prototype.writeFloatLE=function(t,e,r){return E(this,t,e,!0,r)},n.prototype.writeFloatBE=function(t,e,r){return E(this,t,e,!1,r)},n.prototype.writeDoubleLE=function(t,e,r){return G(this,t,e,!0,r)},n.prototype.writeDoubleBE=function(t,e,r){return G(this,t,e,!1,r)},n.prototype.copy=function(t,e,r,i){if(!n.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var o=i-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,i);else if(this===t&&r<e&&e<i)for(var s=o-1;s>=0;--s)t[s+e]=this[s+r];else Uint8Array.prototype.set.call(t,this.subarray(r,i),e);return o},n.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!n.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var o=t.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(t=o)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var s;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(s=e;s<r;++s)this[s]=t;else{var a=n.isBuffer(t)?t:n.from(t,i),l=a.length;if(0===l)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<r-e;++s)this[s+e]=a[s%l]}return this};var Q=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(t,e,r){r.read=function(t,e,r,i,n){var o,s,a=8*n-i-1,l=(1<<a)-1,h=l>>1,u=-7,c=r?n-1:0,f=r?-1:1,p=t[e+c];for(c+=f,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+c],c+=f,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+t[e+c],c+=f,u-=8);if(0===o)o=1-h;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=h}return(p?-1:1)*s*Math.pow(2,o-i)},r.write=function(t,e,r,i,n,o){var s,a,l,h=8*o-n-1,u=(1<<h)-1,c=u>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,d=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),e+=s+c>=1?f/l:f*Math.pow(2,1-c),e*l>=2&&(s++,l/=2),s+c>=u?(a=0,s=u):s+c>=1?(a=(e*l-1)*Math.pow(2,n),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,n),s=0));n>=8;t[r+p]=255&a,p+=d,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;t[r+p]=255&s,p+=d,s/=256,h-=8);t[r+p-d]|=128*y}},{}],4:[function(t,e,r){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function s(t){if(f===clearTimeout)return clearTimeout(t);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function a(){g&&d&&(g=!1,d.length?y=d.concat(y):v=-1,y.length&&l())}function l(){if(!g){var t=o(a);g=!0;for(var e=y.length;e;){for(d=y,y=[];++v<e;)d&&d[v].run();v=-1,e=y.length}d=null,g=!1,s(t)}}function h(t,e){this.fun=t,this.array=e}function u(){}var c,f,p=e.exports={};(function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(t){f=n}})();var d,y=[],g=!1,v=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];y.push(new h(t,e)),1!==y.length||g||o(l)},h.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],5:[function(t,e,r){(function(e,i){(function(){"use strict";function n(){return"object"===(void 0===e?"undefined":_typeof(e))&&"object"===_typeof(e.versions)&&void 0!==e.versions.node}function o(t){return t instanceof Uint8Array&&(!n()||!i.isBuffer(t))}function s(t){return t instanceof ArrayBuffer}function a(t){return!!n()&&i.isBuffer(t)}function l(t){if(!o(t)&&!s(t)&&!a(t))throw new TypeError(f);var e=!1,r=!1;o(t)?e=!0:s(t)&&(r=!0,t=new Uint8Array(t));var n,l,h=new u(t),c=h.readUncompressedLength();if(-1===c)throw new Error("Invalid Snappy bitstream");if(e){if(n=new Uint8Array(c),!h.uncompressToBuffer(n))throw new Error("Invalid Snappy bitstream")}else if(r){if(n=new ArrayBuffer(c),l=new Uint8Array(n),!h.uncompressToBuffer(l))throw new Error("Invalid Snappy bitstream")}else if(n=i.alloc(c),!h.uncompressToBuffer(n))throw new Error("Invalid Snappy bitstream");return n}function h(t){if(!o(t)&&!s(t)&&!a(t))throw new TypeError(f);var e=!1,r=!1;o(t)?e=!0:s(t)&&(r=!0,t=new Uint8Array(t));var n,l,h,u=new c(t),p=u.maxCompressedLength();if(e?(n=new Uint8Array(p),h=u.compressToBuffer(n)):r?(n=new ArrayBuffer(p),l=new Uint8Array(n),h=u.compressToBuffer(l)):(n=i.alloc(p),h=u.compressToBuffer(n)),!n.slice){var d=new Uint8Array(Array.prototype.slice.call(n,0,h));if(e)return d;if(r)return d.buffer;throw new Error("Not implemented")}return n.slice(0,h)}var u=t("./snappy_decompressor").SnappyDecompressor,c=t("./snappy_compressor").SnappyCompressor,f="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";r.uncompress=l,r.compress=h}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{"./snappy_compressor":6,"./snappy_decompressor":7,_process:4,buffer:2}],6:[function(t,e,r){"use strict";function i(t,e){return 506832829*t>>>e}function n(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)}function o(t,e,r){return t[e]===t[r]&&t[e+1]===t[r+1]&&t[e+2]===t[r+2]&&t[e+3]===t[r+3]}function s(t,e,r,i,n){var o;for(o=0;o<n;o++)r[i+o]=t[e+o]}function a(t,e,r,i,n){return r<=60?(i[n]=r-1<<2,n+=1):r<256?(i[n]=240,i[n+1]=r-1,n+=2):(i[n]=244,i[n+1]=r-1&255,i[n+2]=r-1>>>8,n+=3),s(t,e,i,n,r),n+r}function l(t,e,r,i){return i<12&&r<2048?(t[e]=1+(i-4<<2)+(r>>>8<<5),t[e+1]=255&r,e+2):(t[e]=2+(i-1<<2),t[e+1]=255&r,t[e+2]=r>>>8,e+3)}function h(t,e,r,i){for(;i>=68;)e=l(t,e,r,64),i-=64;return i>64&&(e=l(t,e,r,60),i-=60),l(t,e,r,i)}function u(t,e,r,s,l){for(var u=1;1<<u<=r&&u<=y;)u+=1;u-=1;var c=32-u;void 0===g[u]&&(g[u]=new Uint16Array(1<<u));var f,p=g[u];for(f=0;f<p.length;f++)p[f]=0;var d,v,m,x,w,b,L,_,T,S,A,F,I=e+r,C=e,D=e,B=!0,M=15;if(r>=M)for(d=I-M,e+=1,m=i(n(t,e),c);B;){b=32,x=e;do{if(e=x,v=m,L=b>>>5,b+=1,x=e+L,e>d){B=!1;break}m=i(n(t,x),c),w=C+p[v],p[v]=e-C}while(!o(t,e,w));if(!B)break;l=a(t,D,e-D,s,l);do{for(_=e,T=4;e+T<I&&t[e+T]===t[w+T];)T+=1;if(e+=T,S=_-w,l=h(s,l,S,T),D=e,e>=d){B=!1;break}A=i(n(t,e-1),c),p[A]=e-1-C,F=i(n(t,e),c),w=C+p[F],p[F]=e-C}while(o(t,e,w));if(!B)break;e+=1,m=i(n(t,e),c)}return D<I&&(l=a(t,D,I-D,s,l)),l}function c(t,e,r){do{e[r]=127&t,t>>>=7,t>0&&(e[r]+=128),r+=1}while(t>0);return r}function f(t){this.array=t}var p=16,d=1<<p,y=14,g=new Array(y+1);f.prototype.maxCompressedLength=function(){var t=this.array.length;return 32+t+Math.floor(t/6)},f.prototype.compressToBuffer=function(t){var e,r=this.array,i=r.length,n=0,o=0;for(o=c(i,t,o);n<i;)e=Math.min(i-n,d),o=u(r,n,e,t,o),n+=e;return o},r.SnappyCompressor=f},{}],7:[function(t,e,r){"use strict";function i(t,e,r,i,n){var o;for(o=0;o<n;o++)r[i+o]=t[e+o]}function n(t,e,r,i){var n;for(n=0;n<i;n++)t[e+n]=t[e-r+n]}function o(t){this.array=t,this.pos=0}var s=[0,255,65535,16777215,4294967295];o.prototype.readUncompressedLength=function(){for(var t,e,r=0,i=0;i<32&&this.pos<this.array.length;){if(t=this.array[this.pos],this.pos+=1,e=127&t,e<<i>>>i!==e)return-1;if(r|=e<<i,t<128)return r;i+=7}return-1},o.prototype.uncompressToBuffer=function(t){for(var e,r,o,a,l=this.array,h=l.length,u=this.pos,c=0;u<l.length;)if(e=l[u],u+=1,0==(3&e)){if(r=1+(e>>>2),r>60){if(u+3>=h)return!1;o=r-60,r=l[u]+(l[u+1]<<8)+(l[u+2]<<16)+(l[u+3]<<24),r=1+(r&s[o]),u+=o}if(u+r>h)return!1;i(l,u,t,c,r),u+=r,c+=r}else{switch(3&e){case 1:r=4+(e>>>2&7),a=l[u]+(e>>>5<<8),u+=1;break;case 2:if(u+1>=h)return!1;r=1+(e>>>2),a=l[u]+(l[u+1]<<8),u+=2;break;case 3:if(u+3>=h)return!1;r=1+(e>>>2),a=l[u]+(l[u+1]<<8)+(l[u+2]<<16)+(l[u+3]<<24),u+=4}if(0===a||a>c)return!1;n(t,c,a,r),c+=r}return!0},r.SnappyDecompressor=o},{}],8:[function(t,e,r){var i=L.extend({},L.CRS.Earth,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/180,1,-1/180,.5),scale:function(t){return 256*Math.pow(2,t-1)}});e.exports=i},{}],9:[function(t,e,r){L.Control.Attribution.prototype.options={position:"bottomright"},L.Map.TouchZoom.prototype._onTouchMove=(L.Map.TouchZoom.prototype._onTouchMove,function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,r=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]),n=r.distanceTo(i)/this._startDist;if(this._zoom=e.getScaleZoom(n,this._startZoom)+1,!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&n<1||this._zoom>e.getMaxZoom()&&n>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===n)return}else{var o=r._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===n&&0===o.x&&0===o.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),L.Util.cancelAnimFrame(this._animRequest);var s=L.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1})
;this._animRequest=L.Util.requestAnimFrame(s,this,!0),L.DomEvent.preventDefault(t)}}),L.Map.prototype.flyTo=(L.Map.prototype.flyTo,function(t,e,r){function i(t){var e=t?-1:1,r=t?g:y,i=g*g-y*y+e*x*x*v*v,n=2*r*x*v,o=i/n,s=Math.sqrt(o*o+1)-o,a=s<1e-9?-18:Math.log(s);return a}function n(t){return(Math.exp(t)-Math.exp(-t))/2}function o(t){return(Math.exp(t)+Math.exp(-t))/2}function s(t){return n(t)/o(t)}function a(t){return y*(o(w)/o(w+m*t))}function l(t){return y*(o(w)*s(w+m*t)-n(w))/x}function h(t){return 1-Math.pow(1-t,1.5)}function u(){var r=(Date.now()-b)/T,i=h(r)*_;r<=1?(this._flyToFrame=L.Util.requestAnimFrame(u,this),this._move(this.unproject(c.add(f.subtract(c).multiplyBy(l(i)/v)),d),this.getScaleZoom(y/a(i),d),{flyTo:!0})):(e=Math.round(e),this._move(t,e)._moveEnd(!0))}if(r=r||{},!1===r.animate||!L.Browser.any3d)return this.setView(t,e,r);this._stop();var c=this.project(this.getCenter()),f=this.project(t),p=this.getSize(),d=this._zoom;t=L.latLng(t),e=void 0===e?d:e;var y=Math.max(p.x,p.y),g=y*this.getZoomScale(d,e),v=f.distanceTo(c)||1,m=1.42,x=m*m,w=i(0),b=Date.now(),_=(i(1)-w)/m,T=r.duration?1e3*r.duration:1e3*_*.8;return this._moveStart(!0),u.call(this),this}),(window.ActiveXObject||"ActiveXObject"in window)&&(String.prototype.startsWith=function(t){return!(null==t||""==t||0==this.length||t.length>this.length)&&this.substr(0,t.length)==t},String.prototype.endsWith=function(t){return window.ActiveXObject||"ActiveXObject"in window?-1!==this.indexOf(t,this.length-t.length):this.endsWith(t)})},{}],10:[function(t,e,r){e.exports="jssdk_bate@ leaflet 3.0.10"},{}],11:[function(t,e,r){var i=function(){function t(){_classCallCheck(this,t),this.otherDisplay=!0,this.layers=[],this.order=[]}return t.prototype.addFilterLayer=function(t){this.layers.push(t)},t.prototype.removeFilterLayerById=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].id==t&&this.layers.splice(e,1)},t}();e.exports=i},{}],12:[function(t,e,r){var i=function(){function t(){_classCallCheck(this,t),this.id=null,this.filters={},this.idFilter=null,this.filterStr=null,this.display=!0,this.color=null}return t.prototype.addFilterField=function(t,e){this.filters[t]=e},t.prototype.removeFilterField=function(t){delete this.filters[t]},t}();e.exports=i},{}],13:[function(t,e,r){"use strict";var i=e.exports={};t("./ext/LeafletExt"),L.CRS.CustomEPSG4326=t("./ext/CRS.CustomEPSG4326"),i.DataSource=t("./layer/datasource/DataSource"),i.URLDataSource=t("./layer/datasource/URLDataSource"),i.LocalDataSource=t("./layer/datasource/LocalDataSource"),L.GLabelGrid=t("./layer/label/GLabelGrid"),L.GWVTAnno=t("./layer/label/GWVTAnno"),i.Feature=t("./layer/label/feature/Feature"),i.GGroup=t("./layer/vector/stylejs/GGroup"),i.GLevels=t("./layer/vector/stylejs/GLevels"),i.GStyleItem=t("./layer/vector/stylejs/GStyleItem"),L.GDynamicMap=t("./layer/vector/GDynamicMap"),L.GVMapGrid=t("./layer/vector/GVMapGrid"),L.GXYZ=t("./layer/vector/GXYZ"),L.gipStyle=!0,i.GServiceGroup=t("./layer/GServiceGroup"),i.GVMapGridUtil=t("./layer/vector/draw/GVMapGridUtil"),i.Filter=t("./filter/Filter"),i.FilterLayer=t("./filter/FilterLayer")},{"./ext/CRS.CustomEPSG4326":8,"./ext/LeafletExt":9,"./filter/Filter":11,"./filter/FilterLayer":12,"./layer/GServiceGroup":14,"./layer/datasource/DataSource":15,"./layer/datasource/LocalDataSource":16,"./layer/datasource/URLDataSource":17,"./layer/label/GLabelGrid":19,"./layer/label/GWVTAnno":20,"./layer/label/feature/Feature":35,"./layer/vector/GDynamicMap":36,"./layer/vector/GVMapGrid":37,"./layer/vector/GXYZ":38,"./layer/vector/draw/GVMapGridUtil":44,"./layer/vector/stylejs/GGroup":47,"./layer/vector/stylejs/GLevels":48,"./layer/vector/stylejs/GStyleItem":49}],14:[function(t,e,r){var i=function(){function t(e,r,i,n){_classCallCheck(this,t),this.map=null,this.layer=null,this.label=null,this.layerType=0,this.labelType=2,this.map=i,this.url=r,this.layerId=e,this.styleId=null,this.tileSize=256}return t.prototype.addServiceGroup=function(){switch(options&&options.styleId&&(this.styleId=options.styleId),options&&options.tileSize&&(this.tileSize=options.tileSize),this.layerType){case 0:this.addBaseLayer();break;case 1:this.addFrontBaseLayer()}switch(this.labelType){case 2:this.addFrontLabel();break;case 3:this.AddImgLabel();break;case 4:this.addAvoidLabel()}},t.prototype.addBaseLayer=function(){this.layer=new L.GXYZ(this.url+"&x={x}&y={y}&l={z}&tileType="+this.layerType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:this.tileSize}),this.map.addLayer(this.layer)},t.prototype.addFrontBaseLayer=function(){this.layer=new L.GVMapGrid(this.url+"&x={x}&y={y}&l={z}&tileType="+this.layerType,{maxZoom:21,keepBuffer:0,updateWhenZooming:!1,tileSize:this.tileSize}),this.map.addLayer(this.layer)},t.prototype.AddImgLabel=function(){this.label=new L.GXYZ(this.url+"&x={x}&y={y}&l={z}&tileType="+this.labelType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:this.tileSize}),this.map.addLayer(this.label)},t.prototype.addAvoidLabel=function(t){this.label=new L.GLabelGrid(this.url+"&x={x}&y={y}&l={z}&tileType="+this.labelType,{hitDetection:!0,keepBuffer:0,updateWhenZooming:!1,tileSize:this.tileSize}),this.map.addLayer(this.label)},t.prototype.addFrontLabel=function(t){this.label=new L.GWVTAnno("GWVTanno",{tileSize:this.tileSize});var e=new Custom.URLDataSource;e.url=this.url+"&x=${x}&y=${y}&l=${z}&tileType="+this.labelType,this.label.addDataSource(e),this.map.addLayer(this.label)},t.prototype.setLayerType=function(t){"Img"==t?this.layerType=0:"Data"==t&&(this.layerType=1)},t.prototype.setLabelType=function(t){"Data"==t?this.labelType=2:"Img"==t?this.labelType=3:"AvoidImg"==t&&(this.labelType=4)},t.prototype.setTileSize=function(t){this.tileSize=t},t.prototype.getLayer=function(){return this.layer},t.prototype.getLabel=function(){return this.label},t.prototype.removeGroupLayer=function(){this.layer&&this.map.removeLayer(this.layer),this.label&&this.map.removeLayer(this.label)},t}();e.exports=i},{}],15:[function(t,e,r){var i=t("../../utils/UUID"),n=function t(){_classCallCheck(this,t),this.id=(new i).valueOf(),this.type="",this.textures={}};e.exports=n},{"../../utils/UUID":51}],16:[function(t,e,r){var i=t("./DataSource"),n=t("./../../utils/es6-promise"),o=n.Deferred,s=(n.getJSON,function(t){function e(){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,t.call(this));return r.type="LocalDataSource",r.features=[],r.textureUrls={},r}return _inherits(e,t),e.prototype.addFeature=function(t){this.features.push(t)},e.prototype.addTextureUrl=function(t,e){this.textureUrls[t]=e},e.prototype.removeTextureUrl=function(t){delete this.textureUrls[t]},e.prototype.loadTexture=function(){var t=new o,e=0;for(var r in this.textureUrls)e++;if(0!=e){var i=0;for(var n in this.textureUrls){var s=new Image;s.name=n,s.onload=function(r){i++;var n=r.target.name;this.textures[n]=r.target,i==e&&t.resolve()}.bind(this),s.src=this.textureUrls[n]}return t}t.resolve()},e.prototype.removeFeatureById=function(t){for(var e=0;e<this.features.length;e++){var r=this.features[e];r.id==t&&this.features.splice(e,1)}},e}(i));e.exports=s},{"./../../utils/es6-promise":52,"./DataSource":15}],17:[function(t,e,r){var i=t("./DataSource"),n=t("./../../utils/es6-promise"),o=n.Deferred,s=n.getJSON,a=n.getBufferData,l=t("./../../utils/gistools/GisTools"),h=t("../../ext/Version"),u=t("snappyjs"),c=function(t){function e(){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,t.call(this));return r.urlArray=[],r.type="URLDataSource",r.url=null,r.styleUrl=null,r.styleId="style",r.filter=null,r.textures={},r.control=null,r.controlId=null,r.sourceUrl=null,r.host="",r.servername="",r.newEngine=!1,r.serverInfo={},r.layerFieldMap={},r.foreendFont="",r.isLoadServerInfoDef=new o,r}return _inherits(e,t),e.prototype.loadStyle=function(t){var e=this,r=new o,i=new o,n=new o,c=new o,f=new o;return this.isLoadServerInfoDef.then(function(){var o=e.url.split("?")[1];if(e.sourceUrl||(e.sourceUrl=e.url+"&clientVersion="+h,e.url=e.url+"&clientVersion="+h),e.control&&e.isIE()?s({type:"post",url:e.host+"/mapserver/vmap/"+e.servername+"/setControl",data:"control="+e.control,dataType:"json"}).then(function(t){this.controlId=t.id,this.url=this.sourceUrl+"&controlId="+t.id,r.resolve()}.bind(e)):(e.control?e.url=e.sourceUrl+"&control="+encodeURIComponent(e.control):e.url=e.sourceUrl,r.resolve()),t||(t="label"),"_default__"==e.styleId){var p='let layers = drawer.getAllLayer(); layers.setStyle(function(level , get){ return {"type":"_default__","_id":"1","show":true,"pointFillStyle":"#ff0000","radius":5,"lineFillStyle":"#00ff00","lineWidth":3 }})';return e.newEngine?e.styleFun=new Function("render","level",p):e.styleFun=new Function("drawer","level",p),[r]}L.gipStyle?a({url:e.host+"/mapserver/styleInfo/"+e.servername+"/"+e.styleId+"/"+t+"/style.snappy?"+Math.random()+"&"+o,dataType:"arraybuffer"}).then(function(t){var e=l.toBuffer(t.data),r=l.Utf8ArrayToStr(u.uncompress(e));this.newEngine?this.styleFun=new Function("render","level",r):this.styleFun=new Function("drawer","level",r),i.resolve()}.bind(e)):s({url:e.host+"/mapserver/styleInfo/"+e.servername+"/"+e.styleId+"/"+t+"/style.js?"+Math.random()+"&"+o,dataType:"text"}).then(function(t){this.newEngine?this.styleFun=new Function("render","level",t):this.styleFun=new Function("drawer","level",t),i.resolve()}.bind(e)),s({url:e.host+"/mapserver/styleInfo/"+e.servername+"/"+e.styleId+"/label/texture.js?"+Math.random()+"&"+o,dataType:"text"}).then(function(t){var e=JSON.parse(t),r=0;for(var i in e)e[i]&&r++;if(0!=r){var o=0;for(var s in e){var a=new Image;a.name=s,a.onload=function(t){o++;var e=t.target.name;this.textures[e]=t.target,o==r&&n.resolve()}.bind(this),a.src=e[s]}}else n.resolve()}.bind(e)),e.loadFonts(o,c),e.loadforeendUnCommonFonts(o,f)}),[r,i,n,c]},e.prototype.loadServerInfo=function(){var t=this;Object.keys(this.serverInfo).length>0||(this.parseUrl(),this.host&&this.servername&&s({type:"get",url:this.host+"/mapserver/serverInfo/"+this.servername+".json",dataType:"json"}).then(function(e){if(e)if(e.layerMap)for(var r in t.newEngine=!0,e.layerMap)e.layerMap[r].label&&"area"==e.layerMap[r].label.type.toLowerCase()?(t.serverInfo[r]={geometryType:e.layerMap[r].geometryType,fieldsConfig:e.layerMap[r].fields},t.layerFieldMap[r]||(t.layerFieldMap[r]=e.layerMap[r].fields.length+1)):(t.serverInfo[r]={geometryType:e.layerMap[r].geometryType,fieldsConfig:e.layerMap[r].fields},t.layerFieldMap[r]||(t.layerFieldMap[r]=e.layerMap[r].fields.length));else t.newEngine=!1;t.isLoadServerInfoDef.resolve()},function(e){t.isLoadServerInfoDef.resolve()}))},e.prototype.loadforeendUnCommonFonts=function(t,e){s({url:this.host+"/mapserver/styleInfo/fonts/list.json?"+Math.random()+"&"+t,dataType:"json"}).then(function(t){if(t)if(t.foreendUnCommonFont){this.foreendFont=t.foreendUnCommonFont;var r={"font-family":this.foreendFont,"font-weight":"normal","font-style":"normal",urls:{ttf:{url:this.foreendFont+"_normal_normal.ttf",format:"truetype"},woff:{url:this.foreendFont+"_normal_normal.woff",format:"woff"},eot:{url:this.foreendFont+"_normal_normal.eot?#iefix",format:"embedded-opentype"},svg:{url:this.foreendFont+"_normal_normal.svg#iconfont",format:"svg"}}};this.loadFont(r).then(function(){e.resolve()})}else e.resolve()}.bind(this),function(t){e.resolve()})},e.prototype.loadFonts=function(t,e){s({url:this.host+"/mapserver/styleInfo/fonts/"+this.servername+"/"+this.styleId+"/list.json?"+Math.random()+"&"+t,dataType:"json"}).then(function(t){for(var r=[],i=0;i<t.length;i++){var n=t[i];r.push(this.loadFont(n))}Promise.all(r).then(function(){e.resolve()})}.bind(this),function(t){e.resolve()})},e.prototype.loadFont=function(t){var e=new o,r=t["font-family"],i=this.getBrowserFontUrl(t.urls);console.log(i);var n=new XMLHttpRequest,s=this;return n.addEventListener("readystatechange",function(t){if(4==n.readyState)if("fonts"in document){var i=new FontFace(r,n.response);i.load().then(function(t){document.fonts.add(t),e.resolve()}).catch(function(t){console.log("加载字体失败"+r)})}else if("head"in document){for(var o="data:application/x-font-eot;charset=utf-8;base64,",a=new Uint8Array(n.response),l="",h=0;h<a.byteLength;h++)l+=String.fromCharCode(a[h]);var u=btoa(l),c=o+u,f="@font-face{font-family:"+r+";src:url('"+c+"');}";s.createStyleTag(f),e.resolve()}}),n.open("GET",i),n.responseType="arraybuffer",n.send(),e},e.prototype.checkFont=function(t){for(var e=document.fonts.values(),r=!1,i=e.next();!i.done&&!r;){var n=i.value;n.family==t&&(r=!0),i=e.next()}return r},e.prototype.createStyleTag=function(t){if(t){var e=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.appendChild(document.createTextNode(t)),e.appendChild(r)}},e.prototype.parseUrl=function(){var t=this.url.split("?"),e=t[0].split("/mapserver/");this.host=e[0],this.servername=e[1].split("/")[1];for(var r=t[1].split("&"),i=0;i<r.length;i++){var n=r[i],o=n.split("=");if("styleId"==o[0])return void(this.styleId=o[1])}},e.prototype.setFilter=function(t){if(this.control=null,this.url&&t&&(0!=t.layers.length||0!=t.order.length)){for(var e=0;e<t.layers.length;e++){var r=t.layers[e];r.id||t.layers.splice(e,1)}this.control=JSON.stringify(t)}},e.prototype.getTexture=function(t){return this.textures[t]},e.prototype.addTexture=function(t,e){this.textures[t]=e},e.prototype.isIE=function(){if(window.ActiveXObject||"ActiveXObject"in window){var t=navigator.appVersion,e=t.split(";");if(e[1]){var r=e[1].replace(/[ ]/g,"");if("MSIE9.0"==r)return!1}return!0}return!1},e.prototype.getBrowserFontUrl=function(t){var e=this.host+"/mapserver/styleInfo/fonts/",r=navigator.userAgent,i=!!window.ActiveXObject||"ActiveXObject"in window;return r.indexOf("MSIE")>0||i?e+t.eot.url:r.indexOf("Firefox")>0?e+t.woff.url:r.indexOf("Chrome")>0?e+t.ttf.url:(r.indexOf("Opera")>0||r.indexOf("Safari")>0||r.indexOf("Netscape"),null)},e}(i);e.exports=c},{"../../ext/Version":10,"./../../utils/es6-promise":52,"./../../utils/gistools/GisTools":54,"./DataSource":15,snappyjs:5}],18:[function(t,e,r){(function(t){(function(){var r=function(){function e(){_classCallCheck(this,e)}return e.getHeaderArray=function(t){for(var e=[],r=0;r<t;r++)e[r]=this._getRandomNum();return e},e._getRandomNum=function(){var t=80,e=Math.random();return 50+Math.round(e*t)},e.stringToByte=function(e,r){void 0===r&&(r="utf8");for(var i=[],n=t.from(e,r),o=0;o<n.length;o++)i.push(n[o]);return i},e.byteToString=function(e,r){return void 0===r&&(r="utf8"),t.from(e).toString(r)},e.intToBytes=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},e.bytesToInt=function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]},e.varintToInt=function(t){for(var e=[],r=[],i=3,n=0,o=t.length-1;o>=0&&(r[0]=o-1>=0?t[o-1]<<7-n:0,-1!==i);o--)e[i]=(127&t[o])>>n|r[0],i--,n++;var s=e[0]<<24&4278190080|e[1]<<16&16711680|e[2]<<8&65280|255&e[3];return s=s>>1^-(1&s),s},e.intToVarint=function(t){if(0===t)return[0];t=this._zigZagEncoding(t);for(var e=[],r=void 0,i=0,n=5;n>0;n--)r=t>>7*(n-1)&127,0!==i&&(r|=128),0!==r&&e.push(r),i=r;return e},e.varintToIntArray=function(t){for(var e=[],r=void 0,i=0,n=[],o=0;o<t.length;o++)r=0|t[o]>>7&1,0===r&&i>0&&i<=5&&(n.push(this.varintToInt(e)),e=[],i=0),e.push(t[o]),i++;return n.push(this.varintToInt(e)),n},e.intArrayToVarintBuffer=function(e){for(var r=[],i=void 0,n=0;n<e.length;n++)i=this.intToVarint(e[n]),r.push.apply(r,_toConsumableArray(i));return t.from(r)},e._zigZagEncoding=function(t){return t>>31^t<<1},e}();e.exports=r}).call(this)}).call(this,t("buffer").Buffer)},{buffer:2}],19:[function(t,e,r){var i=t("../vector/draw/GXYZUtil"),n=t("../../ext/Version"),o=t("./avoid/GDrawGeomerty"),s=t("./../../utils/es6-promise"),a=s.getJSON,l=L.TileLayer.extend({urlArray:[],sourceUrl:null,textures:{},tileQueue:[],ratio:1,tilesize:512,control:null,controlId:null,hitDetection:!1,initialize:function(t,e){window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize,this.gxyzUtil=new i,this.gxyzUtil.tileSize=this.tilesize,this.gxyzUtil.parseUrl(t),this._url=t+"&tilesize="+this.tilesize+"&clientVersion="+n,L.setOptions(this,e),e&&(this.hitDetection=e.hitDetection),this.on("tileunload",this._onTileRemove),this.on("tileload",this._onTileLoad),this.on("tileerror",this._onTileError)},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-pane leaflet-overlay-pane"),this.getPane().appendChild(this._container))},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+n+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+n+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={},a({url:this.gxyzUtil.host+"/mapserver/styleInfo/"+this.gxyzUtil.servername+"/"+this.gxyzUtil.styleId+"/label/texture.js",dataType:"text"}).then(function(t){var e=JSON.parse(t),r=0;for(var i in e)r++;0==r&&(this._resetView(),this._update());var n=0;for(var o in e){var s=new Image;s.name=o,s.onload=function(t){n++;var e=t.target.name;this.textures[e]=t.target,n==r&&(this._resetView(),this._update())}.bind(this),s.src=e[o]}}.bind(this))},createTile:function(t,e){var r=this.tileQueue.pop();r?this._cleanTile(r):r=this.initTile();var i=this.getTileUrl(t);return a({url:i,dataType:"json"}).then(function(t){r.data=t,this._tileOnLoad.apply(this,[e,r])}.bind(this),function(t){this._tileOnError.apply(this,[e,r,t])}.bind(this)),r},getTileUrl:function(t){var e={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=r),e["-y"]=r}if(0==this.urlArray.length)return L.Util.template(this._url,L.extend(e,this.options));var i=this.urlArray.length-1,n=Math.round(Math.random()*i),o=this.urlArray[n],s=this._url.split("/mapserver"),a=s[1];return o=o+"/mapserver"+a,L.Util.template(o,L.extend(e,this.options))},initTile:function(){var t=document.createElement("canvas");t.style.width=this.tilesize+"px",t.style.height=this.tilesize+"px",t.width=this.tilesize,t.height=this.tilesize;var e=t.getContext("2d",{isQuality:!0});if(t.ctx=e,this.hitDetection){var r=document.createElement("canvas");r.style.width=this.tilesize+"px",r.style.height=this.tilesize+"px",r.width=this.tilesize,r.height=this.tilesize;var i=r.getContext("2d",{isQuality:!0});t.hitCtx=i}return t},_onTileRemove:function(t){this.tileQueue.push(t.tile)},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,L.DomUtil.remove(e))},_onTileLoad:function(t){var e=t.tile;this._drawTile(e,e.data),e.complete=!0},_onTileError:function(t){var e=t.tile;e.complete=!0,this.tileQueue.push(e)},_tileOnError:function(t,e,r){t(r,e)},_drawTile:function(t,e){for(var r=t.ctx,i=(t.hitCtx,{}),n=0;n<e.length;n++){var s=e[n];1!=s.type?2==s.type&&o.drawLine(r,s,this.ratio):(s.id=Math.round(256*Math.random()*256*256),i[s.id]=s,s.iconImg=this.textures[s.style.texture],o.drawPointIcon(r,s,this.ratio,!1,t.hitCtx,this.hitDetection),o.drawPoint(r,s,this.ratio,!1,!1,t.hitCtx,this.hitDetection))}t.featureIdMap=i},_cleanTile:function(t){t.ctx.clearRect(0,0,this.tilesize,this.tilesize),t.hitCtx&&t.hitCtx.clearRect(0,0,this.tilesize,this.tilesize)},getFeatureByXY:function(t,e){var r=null;if(this.hitDetection){var i,n=this._map.containerPointToLatLng(new L.point(t,e)),o=this._map.options.crs.projection.bounds,s=this._map.getBounds(),a=this._map.getPixelBounds(),l=(s._northEast.lat-s._southWest.lat)/(a.max.y-a.min.y),h=this.tilesize,u=(o.max.y-n.lat)/(l*h),c=(n.lng-o.min.x)/(l*h),f=Math.floor(u),p=Math.floor(c),d=this._map.getZoom(),y=this._tiles[p+":"+f+":"+d].el,g=(c-p)*h,v=(u-f)*h,m=y.hitCtx.getImageData(g,v,1,1).data;if(255===m[3]){var x=m[2]+256*(m[1]+256*m[0]);if(x){i=x-1;try{r=y.featureIdMap[i]}catch(t){}}}}return r},_update:function(t){this.isSetIngFilter||L.TileLayer.prototype._update.call(this)},setFilter:function(t){if(this.isSetIngFilter=!0,!this._url||!t||0==t.layers.length&&0==t.order.length)return this.isSetIngFilter=!1,this.controlId=null,this.control=null,void this.setUrl(this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+n);this.gxyzUtil.setFilter(t,function(t){this.isSetIngFilter=!1,t.isIE?(this.controlId=t.id,this.setUrl(this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+n+"&controlId="+t.id)):(this.control=t.id,this.setUrl(this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+n+"&control="+t.id))}.bind(this))}});e.exports=l},{"../../ext/Version":10,"../vector/draw/GXYZUtil":45,"./../../utils/es6-promise":52,"./avoid/GDrawGeomerty":27}],20:[function(t,e,r){var i=t("./draw/CanvasLayer"),n=L.Layer.extend({canvasLayer:null,currLevel:2,ratio:1,hitDetection:!0,cellsize:4,options:{tileSize:512,opacity:1},initialize:function(t){L.setOptions(this,t),this.options.hasOwnProperty("hitDetection")&&(this.hitDetection=this.options.hitDetection),this.options.hasOwnProperty("cellsize")&&(this.cellsize=this.options.cellsize),window.devicePixelRatio>1.5&&(this.ratio=2),this.canvasLayer=new i,this.canvasLayer.tileSize=this.options.tileSize,this.options.hasOwnProperty("ableAvoid")&&(this.canvasLayer.ableAvoid=this.options.ableAvoid),this.options.hasOwnProperty("debug")&&(this.debug=this.options.debug,this.canvasLayer.setDebug(this.debug)),this.animating=!1},onAdd:function(){this.canvasLayer.hitDetection=this.hitDetection,this.canvasLayer.ratio=this.ratio;var t=this._map.options.crs.projection.bounds;this.canvasLayer.init(this._map._size.x,this._map._size.y,this.options.tileSize,this),this.canvasLayer.maxExtent=[t.min.x,t.min.y,t.max.x,t.max.y],this._container=this.canvasLayer.root,this._zoomAnimated&&L.DomUtil.addClass(this._container,"leaflet-zoom-animated"),this.canvasLayer.root.style.opacity=this.options.opacity,this.getPane().appendChild(this.canvasLayer.root),this._update()},setOpacity:function(t){this.options.opacity=t,this.canvasLayer.root&&(this.canvasLayer.root.style.opacity=this.options.opacity)},setAbleAvoid:function(t){this.canvasLayer&&(this.canvasLayer.ableAvoid=t,this.redraw())},getEvents:function(){var t={resize:this.onResize,movestart:this.onMoveStart,zoom:this._onZoom,moveend:this._onMoveend};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},onResize:function(t){this.canvasLayer.tileSize=this.options.tileSize,this.canvasLayer.gwvtAnno=this,this.canvasLayer.initCanvas(this._map._size.x,this._map._size.y),this._update()},_onAnimZoom:function(t){this.updateTransform(t.center,t.zoom)},_onZoom:function(){this.updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveend:function(){this.animating=!1,this._update()},updateTransform:function(t,e){this._zoom&&this._center||(this._zoom=this._map.getZoom(),this._center=this._map.getCenter());var r=this._map.getZoomScale(e,this._zoom),i=this.getCanvasXY(),n=this._map.getSize().multiplyBy(.5),o=this._map.project(this._center,e),s=this._map.project(t,e),a=s.subtract(o),l=n.multiplyBy(-r).add(i).add(n).subtract(a);L.Browser.any3d?L.DomUtil.setTransform(this.canvasLayer.root,l,r):L.DomUtil.setPosition(this.canvasLayer.root,l)},onMoveStart:function(){this.animating=!0},_update:function(){var t=this._map;if(t){var e=t.getBounds(),r=t.getPixelBounds(),i=t.options.crs.projection.project(e._northEast),n=t.options.crs.projection.project(e._southWest),o=(i.y-n.y)/(r.max.y-r.min.y),s=t.options.crs.projection.bounds,a=Math.floor((s.max.y-i.y)/(o*this.options.tileSize)),l=Math.ceil((s.max.y-n.y)/(o*this.options.tileSize)),h=Math.floor((n.x-s.min.x)/(o*this.options.tileSize)),u=Math.ceil((i.x-s.min.x)/(o*this.options.tileSize)),c=t.getZoom(),f=this.currLevel!=c,p=this.getGrid(a,l,h,u,c);this.canvasLayer.extent=[n.x,n.y,i.x,i.y],this.canvasLayer.res=o,this.canvasLayer.requestLabelTiles(p,f),this.currLevel=c}},getGrid:function(t,e,r,i,n){for(var o=[],s=r;s<i;s++)for(var a=t;a<e;a++)o.push({row:a,col:s,level:n});return o},resetCanvasDiv:function(){var t=this.getCanvasXY();L.DomUtil.setPosition(this._container,t),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},getCanvasXY:function(){var t,e=this._map.dragging._draggable._element.style;t=e.transform?e.transform.match(/(-?\d+\.?\d*)(px)/g):[e.left,e.top];var r=t[0].replace("px",""),i=t[1].replace("px","");return{x:-r,y:-i}},redraw:function(){this.canvasLayer&&this.canvasLayer.redraw()},addDataSource:function(t){this.canvasLayer.addDataSource(t)},removeDataSourceById:function(t){this.canvasLayer.removeDataSourceById(t)},onRemove:function(t){L.DomUtil.remove(this.canvasLayer.root)},addToMap:function(t){t.addLayer(this)},getFeatureByXY:function(t,e){return this.canvasLayer.getFeatureByXY(t,e)},setHasImportant:function(t){this.canvasLayer&&(this.canvasLayer.hasImportant=t)},getHasImportant:function(){return!this.canvasLayer||this.canvasLayer.hasImportant},setDebug:function(t){this.debug!=t&&(this.debug=t,this.canvasLayer&&(this.canvasLayer.setDebug(this.debug),this._update()))},getFeaturesByXY:function(t,e){return this.canvasLayer.getFeaturesByXY(t,e)},highlightLabel:function(t,e){e||(e="#ff0000"),this.canvasLayer.highlightLabel(t,e),this._update()},getCurrentLabels:function(){return this.canvasLayer.features},CLASS_NAME:"L.GWVTAnno"});e.exports=n},{"./draw/CanvasLayer":33}],21:[function(t,e,r){(function(t){(function(){var r=function(){function e(){_classCallCheck(this,e),this.layerHeaderProBuffer=t.alloc(0),this.coordinateBufferArray=[],this.featureArray=[]}return e.prototype.getLayerHeaderProBuffer=function(){return this.layerHeaderProBuffer},e.prototype.setLayerHeaderProBuffer=function(t){this.layerHeaderProBuffer=t},e.prototype.getFeatureArray=function(){return this.featureArray},e.prototype.setFeatureArray=function(t){this.featureArray=t},e.prototype.getCoordinateBufferArray=function(){return this.coordinateBufferArray},e.prototype.setCoordinateBufferArray=function(t){this.coordinateBufferArray=t},e}();e.exports=r}).call(this)}).call(this,t("buffer").Buffer)},{buffer:2}],22:[function(t,e,r){var i=t("snappyjs"),n=t("./CodeTool"),o=t("./LayerContentModel"),s=t("../../utils/gistools/GisTools"),a=function(){function t(e,r,i){_classCallCheck(this,t),this.headerLength=r,this.proSizeObj=i,this.intLength=4,this.vectorName="vector",this.gTypeKey="gType",this.encoding="utf8",this.featureSpace="#@",this.vectorVarintBuffer=e,this.layerMap=new Object,this.vectorHeaderProMap=new Object,this.layerHeaderProMap=new Object,this.layerHeaderProBuffer=new Object,this.geometyTypeMap=new Object,this.featureMap=new Object,this.featureArrayMap=new Object,this.offsetBufferMap=new Object,this.offsetArrayMap=new Object,this.varintMap=new Object,this._parseVector(e)}return t.prototype.getVectorHeaderProMap=function(){return this.vectorHeaderProMap},t.prototype.getLayerHeaderProMap=function(){return this.layerHeaderProMap},t.prototype.getLayerBuffer=function(t){return this.layerMap[t]},t.prototype.getLayerProByFilter=function(t,e){for(var r=[],i=this.offsetArrayMap[t],n=this._lazyParseFeature(t),s=[],a=void 0,l=void 0,h=void 0,u=(this.proSizeObj[t],0);u<e.length;u++)a=e[u],s.push.apply(s,_toConsumableArray(n[a])),l=i[2*a],h=i[2*a+1],r.push(this.varintMap[t].slice(l,l+h));var c=new o;return c.setLayerHeaderProBuffer(this.layerHeaderProBuffer[t]),c.setFeatureArray(s),c.setCoordinateBufferArray(r),c},t.prototype.getAllLayerNames=function(){var t=[];for(var e in this.layerMap)t.push(e);return t},t.prototype.getGeometryType=function(t){return this.geometyTypeMap[t]},t.prototype.getLayerProByIndex=function(t,e){var r=this._lazyParseFeature(t);return r[e]},t.prototype.getLayerPro=function(t){return this._lazyParseFeature(t)},t.prototype.getOffsetArray=function(t){return this.offsetArrayMap[t]},t.prototype.getOffsetByIndex=function(t,e){var r=this.offsetArrayMap[t],i=[];return i.push(r[2*e]),i.push(r[2*e+1]),i},t.prototype.getLayerCoordinate=function(t){return this.varintMap[t]},t.prototype.getLayerFeature=function(t){return[this.featureMap[t],this.offsetArrayMap[t],this.varintMap[t]]},t.prototype.getAllCoordinates=function(t,e){for(var r=this.offsetArrayMap[t],i=this.varintMap[t],n=[],o=void 0,s=void 0,a=void 0,l=0;l<r.length/2;l++)o=r[2*l],s=r[2*l+1],a=i.slice(o,o+s),n.push(this._bufferToDoubleArray(a,e)[0]);return n},t.prototype.getCoordinatesByIndex=function(t,e,r){var i=this.getOffsetByIndex(t,e),n=this.varintMap[t],o=i[0],s=i[1],a=n.slice(o,o+s);return this._bufferToDoubleArray(a,r)[0]},t.prototype._parseVector=function(t){var e=this.headerLength,r=t.readInt32BE(e);e+=this.intLength;var i=t.slice(e,e+r).toString("utf-8");if(e+=r,i===this.vectorName){var n=this._parseHeaderPro(t,e);e=n[0],this.vectorHeaderProMap=n[1];var o=t.readInt32BE(e);e+=this.intLength;var s=t.slice(e,e+o);e+=o;for(var a=t.slice(e,this.vectorVarintBuffer.length),l=0,h=void 0,u=void 0,c=0,f=0,p=0,d=void 0,y=0;y<s.length;)f=y,l=s.readInt32BE(f),f+=this.intLength,p=f+l,h=s.toString(this.encoding,f,p),f=p,u=s.readInt32BE(f),f+=this.intLength,d=a.slice(c,c+u),c+=u,this.layerMap[h]=d,this._parseLayer(h,d),y=f}else console.error("不是瓦片数据！")},t.prototype._parseLayer=function(t,e){if(0!==e.length){var r=this.headerLength,n=this._parseHeaderPro(e,r);r=n[0],this.layerHeaderProMap[t]=n[1],this.layerHeaderProBuffer[t]=n[2];var o=this.layerHeaderProMap[t][this.gTypeKey];this.geometyTypeMap[t]=o;var s=e.readInt32BE(r);r+=this.intLength;var a=e.slice(r,r+s);a=i.uncompress(a),r+=s,this.featureMap[t]=a;var l=this._parseIndex(e,r);r=l.offset,this.offsetBufferMap[t]=l.buffer,this.offsetArrayMap[t]=l.array;var h=e.slice(r);this.varintMap[t]=h}},t.prototype._parseHeaderPro=function(t,e){var r=new Object,n=t.readInt32BE(e);e+=this.intLength;var o=t.slice(e,e+n);if(e+=n,0==n)return[e,r];for(var a=s.Utf8ArrayToStr(i.uncompress(o)).split(":"),l=0;l<a.length/2;l++)r[a[2*l]]=a[2*l+1];return[e,r,o]},t.prototype._parseIndex=function(t,e){var r=t.readInt32BE(e);e+=this.intLength;var i=t.slice(e,e+r);e+=r;var o=n.varintToIntArray(i);return{offset:e,buffer:i,array:o}},t.prototype._lazyParseFeature=function(t){var e=this.featureArrayMap[t],r=this.proSizeObj[t];if(null==e){var i=this.featureMap[t],n=[];if(!(i.length>0))return this.featureArrayMap[t]=[],[];n=s.Utf8ArrayToStr(this.featureMap[t]).split(this.featureSpace);var o=[],a=(n.length-1)/r;e=[];for(var l=0,h=l,u=0;u<a;u++)h=l+r,o=n.slice(l,h),e.push(o),l=h;this.featureArrayMap[t]=e}return e},t.prototype._bufferToDoubleArray=function(t,e){for(var r=[],i=[],o=void 0,s=0,a=[],l=0,h=0,u=void 0,c=void 0,f=!0,p=0;p<=t.length;p++)o=0|t[p]>>7&1,0===o&&s>0&&(s>0&&s<=5?(f?(u=n.varintToInt(r)+l,i.push(u/e),f=!1,l=u):(c=n.varintToInt(r)+h,i.push(c/e),f=!0,h=c),s=0,r=[]):s>5&&(l=0,h=0,s=0,r=[],a.push(i),i=[])),p!==t.length?(r.push(t[p]),s++):i.length>0&&a.push(i);return a},t}();e.exports=a},{"../../utils/gistools/GisTools":54,"./CodeTool":18,"./LayerContentModel":21,snappyjs:5}],23:[function(t,e,r){var i=null,n="./../../../../",o=function(){function e(){_classCallCheck(this,e)}return e.getRealLength=function(t){for(var e=t.length,r=0,i=0;i<e;i++){var n=t.charCodeAt(i);r+=n>=0&&n<=128?.5:1}return r},e.isNotNull=function(t){return!(!t&&0!=t)&&("string"!=typeof t||(t=t.toLowerCase(),""!=t&&"undefined"!=t&&"null"!=t))},e.formatFont=function(e,r,o){var s=e;if(o){null==i&&(i=t(n+"src/utils/font/Font"));var a=e.split(" ");a.length-1!=0&&"italic"==a[0].toLowerCase()?"simhei"!=a[a.length-1]&&(a[a.length-1]=i.getDefaultFont()+"_italic"):a[a.length-1]=i.getDefaultFont(),s=a.join(" ")}return s.replace(/(\d+\.?\d*)(px|em|rem|pt)/g,function(t,e,i){return e=Math.round(e)*r,e+i})},e.formatLabel=function(t){return t&&t.length>0&&(t=t.replace(/([\x00-\x1f\x7f])/g,""),t=t.replace(/(\s*$)/g,""),t=t.replace(/<br\/>/g,"")),t},e.getAngle=function(t,e){if(e[0]-t[0]==0)return e[1]>t[0]?90:-90;var r=(e[1]-t[1])/(e[0]-t[0]),i=360*Math.atan(r)/(2*Math.PI);return i},e}();e.exports=o},{}],24:[function(t,e,r){var i=t("./GGridIndex"),n=t("./GLabelBox"),o=t("./Util"),s=function(){function t(e,r,i){_classCallCheck(this,t),this.grid=null,this.GLabelBox=new n(e,r),
this.debug=i}return t.prototype.avoid=function(t,e,r){for(var i=0;i<t.length;i++){var n=t[i],o=e[n.styleId];1==n.type&&this.avoidPointLine(n,r,o),2==n.type&&(n.isCollision=this.avoidLineLine(n,r))}return t},t.prototype.avoidPointLine=function(t,e,r){var i=t.weight;e=this.getAvoidLineFeatures(i,e);var n=t.boxs.length;t.boxIndexs={};for(var o=0;o<n;o++)t.boxIndexs[o]=!0;for(var s=0,a=0;a<e.length;a++)for(var l=e[a],h=0;h<n;h++){var u=t.boxs[h],c=this.crashBoxLine(u,l.sourceDatas,!1);if(c&&t.boxIndexs[h]&&(delete t.boxIndexs[h],s++,s==n))return!0}return!1},t.prototype.avoidLineLine=function(t,e){var r=t.weight;e=this.getAvoidLineFeatures(r,e);for(var i=0;i<e.length;i++)for(var n=e[i],o=!1,s=!1,a=0;a<t.boxs.length;a++){var l=t.boxs[a],h=[];if(h.push([l[0],l[1],l[2],l[3]]),h.push([l[2],l[1],l[0],l[3]]),o=this.crashPartLineLine(h[0],n.sourceDatas),s=this.crashPartLineLine(h[1],n.sourceDatas),o||s)return!0}return!1},t.prototype.getAvoidLineFeatures=function(t,e){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=n.weight;o>t&&r.push(n)}return r},t.prototype.crashBoxLine=function(t,e,r){var i=[];r?(i.push([t[0],t[1],t[2],t[1]]),i.push([t[2],t[1],t[2],t[3]]),i.push([t[2],t[3],t[0],t[3]]),i.push([t[0],t[3],t[0],t[1]])):(i.push([t[0],t[1],t[2],t[3]]),i.push([t[2],t[1],t[0],t[3]]));for(var n=0;n<i.length;n++)for(var o=i[n],s=0;s<e.length/2-1;s++){var a=[e[2*s],e[2*s+1],e[2*(s+1)],e[2*(s+1)+1]];if(this.crashPartLinePartLine(o,a))return!0}return!1},t.prototype.crashLineLine=function(t,e){for(var r=0;r<t.length/2-1;r++)for(var i=[t[2*r],t[2*r+1],t[2*(r+1)],t[2*(r+1)+1]],n=0;n<e.length/2-1;n++){var o=[e[2*n],e[2*n+1],e[2*(n+1)],e[2*(n+1)+1]];if(this.crashPartLinePartLine(i,o))return!0}return!1},t.prototype.crashPartLineLine=function(t,e){for(var r=0;r<e.length/2-1;r++){var i=[e[2*r],e[2*r+1],e[2*(r+1)],e[2*(r+1)+1]];if(this.crashPartLinePartLine(t,i))return!0}return!1},t.prototype.crashPartLinePartLine=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=e[0],a=e[1],l=e[2],h=e[3],u=void 0,c=void 0,f=void 0,p=void 0,d=void 0,y=void 0,g=void 0,v=void 0,m=void 0;if(f=n-r,p=o-i,d=l-s,y=h-a,m=f*y-d*p,0==m)return 0;var x=m>0;return u=r-s,c=i-a,g=f*c-p*u,g<0==x?0:(v=d*c-y*u,v<0==x?0:g>m==x||v>m==x?0:1)},t.prototype.defaultAvoid=function(t,e,r,n,s){if(this.grid=r?new i(4096,32,0):new i(512,32,32),null==t||t.length<1)return[];t=this.GLabelBox.setBox(t,e,r),t=this.mergeFeatures(t),s&&o.sort(t,e,n);for(var a=0;a<t.length;a++){var l=t[a],h=e[l.styleId];this.avoidFeature(l,h)}var u=this.GLabelBox.filterFeature(t);return this.removeRepeat(u,e),u=this.filterFeature(u),this.prevFeatures=u,this.debug?t:u},t.prototype.avoidFeature=function(t,e){0!=e.show&&1!=t.hidden&&t.boxs?1==t.type?this.avoidPoint(t,e):t.isCollision?t.hidden=!0:this.avoidLine(t,e):t.hidden=!0},t.prototype.avoidPoint=function(t,e){if(1!=e.isImportant)if((e.isFourDirections||e.isEightDirections)&&e.texture)this.addFourCollisionFeatureToCells(t,e,0);else{if(t.boxIndexs&&!t.boxIndexs[0])return void(t.hidden=!0);var r=this.isCollision(t.box);if(r)return void(t.hidden=!0);this.addBoxToCells(t.primaryId,t.box)}else this.addBoxToCells(t.primaryId,t.box)},t.prototype.avoidLine=function(t,e){if(1!=e.isImportant){for(var r=!1,i=0;i<t.boxs.length;i++){var n=t.boxs[i];if(this.isCollision(n)){r=!0;break}}if(r)t.hidden=!0;else for(var o=0;o<t.boxs.length;o++){var s=t.boxs[o];this.addBoxToCells(t.primaryId+"index_"+o,s)}}else for(var a=0;a<t.boxs.length;a++){var l=t.boxs[a];this.addBoxToCells(t.primaryId+"index_"+a,l)}},t.prototype.addFourCollisionFeatureToCells=function(t,e,r){var i=!0,n=[];if((!t.boxIndexs||t.boxIndexs&&t.boxIndexs[r])&&(n=t.boxs[r],i=this.isCollision(n)),i){if(r++,r==t.boxs.length&&(r-=t.boxs.length),0==r)return void(t.hidden=!0);this.addFourCollisionFeatureToCells(t,e,r)}else t.textPoint=t.fourPoints[r],t.box=n,this.addBoxToCells(t.primaryId,n)},t.prototype.isCollision=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=this.grid.query(e,r,i,n);return o.length>0},t.prototype.addBoxToCells=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3];this.grid.insert(t,r,i,n,o)},t.prototype.mergeFeatures=function(t){for(var e={},r=0;r<t.length;r++){var i=t[r];e[i.attributeId]||(e[i.attributeId]=[]),e[i.attributeId].push(i)}for(var n in e){var o=e[n];if(o.length>1){var s=o[0];if(!s.boxIndexs)continue;if("1"==s.type){for(var a=s.boxIndexs,l=1;l<o.length;l++)a=this.getBothDirection(a,o[l].boxIndexs);var h=!0;for(var u in a){h=!1;break}for(var c=0;c<o.length;c++)h?o[c].hidden=!0:o[c].boxIndexs=a}s.type}}return this.GLabelBox.filterFeature(t)},t.prototype.getBothDirection=function(t,e){var r={};for(var i in t)e&&e[i]&&(r[i]=!0);return r},t.prototype.getDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.pow(r*r+i*i,.5)},t.prototype.filterFeature=function(t){for(var e=[],r=0;r<t.length;r++)t[r].hidden||(t[r].drawed=!0,e.push(t[r]));return e},t.prototype.removeRepeat=function(t,e){for(var r=[],i=[],n=[],o=[],s=[],a=[],l=0;l<t.length;l++){var h=t[l];1==h.type?1==h.drawed?o.push(h):r.push(h):2==h.type&&("text"==h.lineType&&(1==h.drawed?s.push(h):i.push(h)),"code"==h.lineType&&(1==h.drawed?a.push(h):n.push(h)))}for(var u=0;u<r.length;u++){var c=r[u];this.getShowPointFeatrues(o,c,e)}for(var f=0;f<i.length;f++){var p=i[f];this.getShowLineTextFeatrues(s,p,e)}for(var d=0;d<n.length;d++){var y=n[d];this.getShowLineCodeFeatrues(a,y,e)}if(this.prevFeatures)for(var g=0;g<this.prevFeatures.length;g++){var v=this.prevFeatures[g];v.drawed=!1}},t.prototype.getShowPointFeatrues=function(t,e,r){for(var i=!1,n=0;n<t.length;n++){var o=t[n],s=r[o.styleId];if(o.label==e.label&&s.distance&&r[e.styleId].distance){var a=this.getDistance(o.centerPoint,e.centerPoint);a<s.distance&&(i=!0,e.hidden=!0)}}i||t.push(e)},t.prototype.getShowLineTextFeatrues=function(t,e,r){for(var i=!1,n=0;n<t.length;n++){var o=t[n],s=r[o.styleId];if(o.label==e.label&&s.lineTextDistance&&r[e.styleId].lineTextDistance){var a=this.getDistance(o.centerPoint,e.centerPoint);a<s.lineTextDistance&&(i=!0,e.hidden=!0)}}i||t.push(e)},t.prototype.getShowLineCodeFeatrues=function(t,e,r){for(var i=!1,n=0;n<t.length;n++){var o=t[n],s=r[o.styleId];if(o.label==e.label&&s.lineCodeDistance&&r[e.styleId].lineCodeDistance){var a=this.getDistance(o.centerPoint,e.centerPoint);a<s.lineCodeDistance&&(i=!0,e.hidden=!0)}}i||t.push(e)},t.prototype.getDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.pow(r*r+i*i,.5)},t}();e.exports=s},{"./GGridIndex":28,"./GLabelBox":29,"./Util":32}],25:[function(t,e,r){var i=t("./GDistance"),n=t("./../../../utils/gistools/GisTools"),o=t("./AvoidUtil"),s=function(){function t(){_classCallCheck(this,t)}return t.cutLineFeature=function(t,e){var r=[],i=0;if(t.sourceData.length<4)return r;var n=[{weight:t.codeAvoidWeight,fun:this.createLineCodeFeatrue},{weight:t.weight,fun:this.createLineTextFeatrue},{weight:t.arrowAvoidWeight,fun:this.createLineArrowFeatrue}];n=this.sort(n);for(var o=0;o<n.length;o++){var s=n[o].fun,a=s.call(this,t,e,i);i=a.index,a.feature&&r.push(a.feature)}return r},t.sort=function(t){if(t.length>0)return t.sort(function(t,e){return t.weight<e.weight?1:t.weight==e.weight?0:-1})},t.createLineTextFeatrue=function(t,e,r){var s=t.sourceData,a=new i,l=[],h=null;if(o.isNotNull(t.label)&&r<s.length){t.label=t.label+"";for(var u=0;u<t.label.length;u++)l.push(1.2*e.lineHeight+2+e.gap);l[0]=l[0]+30;[].concat(l);var c=a.getNodePath(s,l),f=c.pointList;if(f.length>0)if(r=c.index,e.isTransverse)h=this.cloneFeature(t),h.attributeId=h.attributeId+"_text",h.sourceAngleData=[f[0]],h.lineType="text";else{var p=t.label.length-f.length;if(p>0){if(r=s.length,!(p<e.extendedNum))return{feature:null,index:r};this.delayTextPoint(s,f,t.label,e.chinaLabelWidth+e.gap)}var d=[f[0][0][0],f[0][0][1]],y=f[f.length-1][0],g=o.getAngle(d,y);if(h=this.cloneFeature(t),h.angle=g,0!=e.changeDirection){var v=this.isChangeDirection(t.label,d,y,g);v&&(f=f.reverse())}h.attributeId=h.attributeId+"_text",h.sourceAngleData=f,h.lineType="text"}e.lineOffset&&h&&(1==h.sourceAngleData.length?h.sourceAngleData[0][0][1]=h.sourceAngleData[0][0][1]-e.lineOffset:h.sourceAngleData=n.lineOffset(h.sourceAngleData,e.lineOffset))}return{feature:h,index:r}},t.createLineCodeFeatrue=function(t,e,r){var n=t.sourceData,s=new i,a=[],l=null,h=t.roadCodeLabel;if(e.showRoadCode&&o.isNotNull(h)&&r<n.length){var u=n.slice(r,n.length-1);a.push(30);var c=s.getNodePath(u,a),f=c.pointList;1==f.length&&(r+=c.index,l=this.cloneFeature(t),l.attributeId=l.attributeId+"_code",l.sourceAngleData=f,l.lineType="code",l.label=h+"",l.weight=t.codeAvoidWeight)}return{feature:l,index:r}},t.createLineArrowFeatrue=function(t,e,r){var n=t.sourceData,o=new i,s=[],a=null;if(e.showArrow&&r<n.length){var l=e.arrowDirectionValue;e.arrowDirectionField&&(l=t.attributes[e.arrowDirectionField]),e.arrowSize=e.arrowSize?e.arrowSize:6,e.arrowDistance=e.arrowDistance?e.arrowDistance:12,e.arrowLineWidth=e.arrowLineWidth?e.arrowLineWidth:2,e.arrowStrokeStyle=e.arrowStrokeStyle?e.arrowStrokeStyle:"#666666",e.arrowFillStyle=e.arrowFillStyle?e.arrowFillStyle:"#666666",e.arrowDirectionValue=e.arrowDirectionValue?e.arrowDirectionValue:0;var h=n.slice(r,n.length-1);s.push(16),0==l||null==l?(s.push(e.arrowSize),s.push(e.arrowDistance)):(s.push(e.arrowDistance),s.push(e.arrowSize));var u=o.getNodePath(h,s),c=u.pointList;3==c.length&&(a=this.cloneFeature(t),a.attributeId=a.attributeId+"_arrow",a.sourceAngleData=c,a.lineType="arrow",a.weight=t.arrowAvoidWeight)}return{feature:a,index:r}},t.delayTextPoint=function(t,e,r,i){var n=null,o=null;n=1==e.length?[t[0],t[1]]:e[e.length-2][0],o=e[e.length-1][0];for(var s=e[e.length-1][1],a=e.length,l=1;l<r.length-a+1;l++){var h=this.getPoint(n,o,i*l),u=[h,s];e.push(u)}},t.cloneFeature=function(t){return{type:t.type,datas:t.datas,centerPoint:t.centerPoint,sourceData:t.sourceData,label:t.label,roadCodeLabel:t.roadCodeLabel,attributes:t.attributes,attributeId:t.attributeId,styleId:t.styleId,textures:t.textures,xyz:t.xyz,lineType:t.lineType,weight:t.weight}},t.isChangeDirection=function(t,e,r,i){var n=!1;if(/.*[\u4e00-\u9fa5]+.*$/.test(t)){if(e[0]==r[0]&&e[1]>r[1])return n=!0,n;i<-45&&i>-90?e[0]<r[0]&&(n=!0):e[0]>r[0]&&(n=!0)}else e[0]>r[0]&&(n=!0);return n},t.getDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.pow(r*r+i*i,.5)},t.getLineDistance=function(t){if(t.length<4)return 0;for(var e=0,r=0;r<t.length/2-1;r++){var i=[t[2*r],t[2*r+1]],n=[t[2*(r+1)],t[2*(r+1)+1]];e+=this.getDistance(i,n)}return e},t.getPoint=function(t,e,r){var i=e[0]-t[0],n=e[1]-t[1],o=e[0],s=e[1];if(0==i)s=n>0?e[1]+r:e[1]-r;else{var a=Math.sqrt(r*r/(n/i*(n/i)+1));i<0&&(a=-a),o=e[0]+a,s=e[1]+n/i*a}return[o,s]},t}();e.exports=s},{"./../../../utils/gistools/GisTools":54,"./AvoidUtil":23,"./GDistance":26}],26:[function(t,e,r){var i=function(){function t(){_classCallCheck(this,t)}return t.prototype.getLengthPoint=function(t,e,r,i,n,o){var s=r-t,a=i-e,l=void 0,h=void 0;if(0==s)return l=r,h=a>0?e+n:e-n,null==o?[l,h]:[l,h,o];var u=a/s,c=Math.sqrt(u*u+1),f=Math.abs(n/c),p=Math.abs(f*u);return l=s>0?t+f:t-f,h=a>0?e+p:e-p,null==o?[l,h]:[l,h,o]},t.prototype.getAngle=function(t,e){if(e[0]-t[0]==0)return e[1]>t[0]?90:-90;var r=(e[1]-t[1])/(e[0]-t[0]),i=360*Math.atan(r)/(2*Math.PI);return i},t.prototype.length=function(t,e,r,i){var n=r-t,o=i-e,s=Math.sqrt(n*n+o*o);return s},t.prototype.getNodePath=function(t,e){for(var r=[],i={},n=[],o=e.length,s=function(t){var e=t[0];return t.splice(0,1),e},a=s(e),l=0;;){if(n.length==o)return i.index=l,i.pointList=n,i;if(l>=t.length)return i.index=l,i.pointList=n,i;var h=t[l],u=t[l+1];if(0!=r.length){var c=this.length(r[0],r[1],h,u);if(c>=a){var f=this.getLengthPoint(r[0],r[1],h,u,a,null),p=this.getAngle(r,[h,u]);90==p&&(p=0),-90==p&&(p=0),0==p&&(p=.5),p>=45?p-=90:p<=-45&&(p+=90);var d=[f,p];n.push(d),r[0]=f[0],r[1]=f[1],a=s(e)}else a-=c,r[0]=h,r[1]=u,l+=2}else r[0]=h,r[1]=u}return i.index=l,i.pointList=n,i},t}();e.exports=i},{}],27:[function(t,e,r){var i=t("../../../utils/gistools/BoxSet"),n=new i(0,512,0,512,512,5),o=(new i(0,256,0,256,256,5),new i(0,256,0,256,256,5)),s=new i(256,512,0,256,256,5),a=new i(0,256,256,512,256,5),l=new i(256,512,256,512,256,5),h=t("../../../utils/gistools/GisTools"),u=t("./Util"),c=t("./AvoidUtil"),f=function(){function t(){_classCallCheck(this,t)}return t.draw=function(t,e,r,i,n,o,s,a,l,h){t.lineJoin="round";var u=null;n&&(u=new Map),h&&(e=this.sort(e));for(var c=0;c<e.length;c++){var f=e[c],p=r[f.styleId];if(1!=f.type){if(2==f.type&&(this.drawLine(t,f,p,i,u,o,s,a,l),h))for(var d=0;d<f.boxs.length;d++){var y=f.boxs[d];this.drawAvoidBox(t,y,f.hidden)}}else this.drawPointIcon(t,f,p,i,u,s,a),this.drawPoint(t,f,p,i,u,o,s,a,l),h&&this.drawAvoidBox(t,f.box,f.hidden)}u=null},t.drawDefaultStyle=function(t,e,r,i,n,o,s,a){var l=null;n&&(l=new Map);for(var h=0;h<e.length;h++){var u=e[h],c=r[u.styleId];1!=u.type?2==u.type&&this.drawLineDefaultStyle(t,u,c,i,l,o,s,a):this.drawPointDefaultStyle(t,u,c,i,l,o,s,a)}l=null},t.drawPointIcon=function(t,e,r,i,n,o,s){if(r.texture){var a=r.graphicWidth,l=r.graphicHeight,h=e.iconImg;if(h){a&&l||(a=h.width,l=h.height,n&&(a/=i,l/=i));var u=r.graphicXOffset-.5*a,c=r.graphicYOffset-.5*l,f=r.pointOffsetX,p=r.pointOffsetY;f||(f=0),p||(p=0);var d=[e.datas[0][0][0],e.datas[0][0][1]];d[0]=d[0]+f,d[1]=d[1]+p;var y=d[0]+u,g=d[1]+c,v=r.pointFillAlpha||1;if(n){var m=r.texture+"_"+y+"_"+g;if(null!=n.get(m))return;n.set(m,!0)}t.save(),t.globalAlpha=v,t.drawImage(h,y*i,g*i,a*i,l*i),t.restore(),s&&(o.save(),this.setHitContextStyle(o,e.id),o.fillRect(y,g,a,l),o.restore())}}},t.drawPoint=function(t,e,r,i,n,o,s,a,l){if(e.label){var f=e.textPoint;if(n){var p=h.boxToPolyArr(e.box[0],e.box[1],e.box[2],e.box[3]),d=void 0;if(t.canvas.width/i==512)d=h.boxToPolyArr(-20,-20,532,532);else if(t.canvas.width/i==256)switch(l){case 0:d=h.boxToPolyArr(-15,-15,271,271);break;case 1:d=h.boxToPolyArr(241,-15,527,271);break;case 2:d=h.boxToPolyArr(-15,241,271,527);break;case 3:d=h.boxToPolyArr(241,241,527,527)}if(3==h.polyWith(d,p))return;var y=e.label+"_"+f[0]+"_"+f[1];if(null!=n.get(y))return;n.set(y,!0)}var g=e.label.split(" "),v=g.length,m=r.pointHeight;m+=2;var x=c.formatFont(r.pointFillFont,i,o),w=c.formatFont(r.pointStrokeFont,i,o);t.save(),t.font=w;for(var b=0,L=[],_=0;_<v;_++){var T=u.measureText(g[_].replace(/&nbsp;/g," "),t.font,t);L.push(T),T>b&&(b=T)}t.restore();var S=f[0]-r.pointBackgroundGap,A=f[1]-r.pointBackgroundGap-r.pointHeight/2;1==r.pointHashBackground&&(t.save(),t.globalAlpha=r.pointBackgroundAlpha,t.strokeStyle=r.pointBackgroundLineColor,t.lineWidth=r.pointBackgroundLineWidth,t.fillStyle=r.pointBackgroundColor,t.font=r.pointFillFont,this.drawRoundRect(t,S,A,b/i+2*r.pointBackgroundGap,r.pointHeight*v+2*r.pointBackgroundGap+2*(v-1),r.pointBackgroundRadius,i),t.fill(),t.restore());var F=this.getPointTextDirection(f[0],e.datas[0][0][0],b);this.drawPointText(t,g,F,r,x,w,m,i,f,L,b,e),a&&(1==r.pointHashBackground?(s.save(),this.setHitContextStyle(s,e.id),this.drawHitRoundRect(s,S,A,b/i+2*r.pointBackgroundGap,m*v+2*r.pointBackgroundGap,r.pointBackgroundRadius),s.fill(),s.restore()):(s.save(),this.setHitContextStyle(s,e.id),s.textBaseline="middle",s.fillRect(f[0],f[1]-r.pointHeight/2,b/i,m*v),s.restore()))}},t.getPointTextDirection=function(t,e,r){return t>e?0:e>t+r?1:2},t.drawPointText=function(t,e,r,i,n,o,s,a,l,h,u,c){for(var f=e.length,p=0;p<f;p++){var d=h[p],y=l[0];1==r&&(y=l[0]+(u-d)),2==r&&(y=l[0]+.5*(u-d)),1==i.pointHashOutline&&(t.save(),t.textBaseline="middle",t.globalAlpha=i.pointStrokeAlpha,t.strokeStyle=i.pointStrokeStyle,t.lineWidth=i.pointLineWidth,t.font=o,t.strokeText(e[p].replace(/&nbsp;/g," "),y*a,(l[1]+s*p)*a),t.restore()),t.save(),t.textBaseline="middle",t.globalAlpha=i.pointFillAlpha,c.hasOwnProperty("lightColor")?t.fillStyle=c.lightColor:c.hidden?t.fillStyle="#969393":t.fillStyle=i.pointFillStyle,t.font=n,t.fillText(e[p].replace(/&nbsp;/g," "),y*a,(l[1]+s*p)*a),t.restore()}},t.drawLine=function(t,e,r,i,n,o,s,a,l){"text"==e.lineType&&this.drawLineText(t,e,r,i,n,o,s,a,l),"code"==e.lineType&&this.drawLineCode(t,e,r,i,n,o,s,a),"arrow"==e.lineType&&this.drawLineArrow(t,e,r,i,n,s,a)},t.drawLineText=function(t,e,r,i,h,u,f,p,d){var y=e.label,g=e.textPoints,v=void 0;if(h)if(t.canvas.width/i==512)v=n;else if(t.canvas.width/i==256)switch(d){case 0:v=o;break;case 1:v=s;break;case 2:v=a;break;case 3:v=l}var m=c.formatFont(r.lineFillFont,i,u),x=c.formatFont(r.lineStrokeFont,i,u);if(1==r.lineHashBackground||1==g.length){var w=Math.floor(g.length/2),b=g[w][0];1==g.length?this.drawBgText(t,y,i,b,r.backgroundAlpha,r.backgroundLineColor,r.backgroundLineWidth,r.backgroundColor,r.lineFillFont,r.lineBackgroundGap,r.lineHeight,r.lineBackgroundRadius,r.lineHashOutline,r.lineStrokeAlpha,r.lineStrokeStyle,r.lineLineWidth,r.lineStrokeFont,r.lineFillAlpha,r.lineFillStyle,f,p,e.id,r.lineHashBackground,u,e):this.drawBgText(t,y,i,b,r.backgroundAlpha,r.backgroundLineColor,r.backgroundLineWidth,r.backgroundColor,r.lineFillFont,r.lineBackgroundGap,r.lineHeight,r.lineBackgroundRadius,r.lineHashOutline,r.lineStrokeAlpha,r.lineStrokeStyle,r.lineLineWidth,r.lineStrokeFont,r.lineFillAlpha,r.lineFillStyle,f,p,e.id,!0,u,e)}else for(var L=e.lineFillStyle?e.lineFillStyle:r.lineFillStyle,_=0;_<y.length;_++){var T=g[_],S=T[1],A=T[0],F=y.charAt(_);if(h){var I=F+"_"+A[0]+"_"+A[1]+"_"+S;if(null!=h.get(I))continue;if(h.set(I,!0),!v.in([A[0]/i,A[1]/i]))continue}1==r.lineHashOutline&&(t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=r.lineStrokeAlpha,t.strokeStyle=r.lineStrokeStyle,t.lineWidth=r.lineLineWidth,t.font=x,t.translate(A[0]*i,A[1]*i),t.rotate(S*Math.PI/180),t.strokeText(F,0,0),t.restore()),t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=r.lineFillAlpha,e.hasOwnProperty("lightColor")?t.fillStyle=e.lightColor:e.hidden?t.fillStyle="#969393":t.fillStyle=L,t.font=m,t.translate(A[0]*i,A[1]*i),t.rotate(S*Math.PI/180),t.fillText(F,0,0),t.restore(),p&&(f.save(),this.setHitContextStyle(f,e.id),f.translate(A[0],A[1]),f.rotate(S*Math.PI/180),f.fillRect(1.2*-r.lineHeight*.5,1.2*-r.lineHeight*.5,1.2*r.lineHeight,1.2*r.lineHeight),f.restore())}},t.drawLineCode=function(t,e,r,i,n,o,s,a){var l=e.codePoint,h=e.label;1==r.showRoadCode&&h&&h.length>0&&this.drawBgText(t,h,i,l,r.codeBackgroundAlpha,r.codeBackgroundLineColor,r.codeBackgroundLineWidth,r.codeBackgroundColor,r.codeLineFillFont,r.codeLineBackgroundGap,r.codeLineHeight,r.codeLineBackgroundRadius,r.codeLineHashOutline,r.codeLineStrokeAlpha,r.codeLineStrokeStyle,r.codeLineLineWidth,r.codeLineStrokeFont,r.codeLineFillAlpha,r.codeLineFillStyle,s,a,e.id,!0,o,e)},t.drawLineArrow=function(t,e,r,i,n,o,s){var a=e.arrowPoint,l=r.arrowDirectionValue;r.arrowDirectionField&&(l=e.attributes[r.arrowDirectionField]);var h=a[0][0],u=a[1][0];0!=l&&null!=l||(h=a[1][0],u=a[2][0]),t.save(),t.lineWidth=r.arrowLineWidth,t.strokeStyle=r.arrowFillStyle,e.hasOwnProperty("lightColor")?t.fillStyle=e.lightColor:e.hidden?t.fillStyle="#969393":t.fillStyle=r.arrowFillStyle,t.beginPath(),t.moveTo(h[0]*i,h[1]*i),t.lineTo(u[0]*i,u[1]*i),t.stroke();var c=0,f=0;u[0]==h[0]?(l&&u[1]>h[1]||!l&&u[1]<h[1])&&(c=Math.PI):(c=Math.atan((u[1]-h[1])/(u[0]-h[0])),f=(u[0]>h[0]?90:-90)*Math.PI/180),0==l?(c-=f,this.drawArrowhead(t,h[0],h[1],c,i,r.arrowSize)):(c+=f,this.drawArrowhead(t,u[0],u[1],c,i,r.arrowSize)),t.restore()},t.drawArrowhead=function(t,e,r,i,n,o){t.beginPath(),t.translate(e*n,r*n),t.rotate(i),t.moveTo(0,-o*n),t.lineTo(.5*o*n,0),t.lineTo(.5*-o*n,0),t.closePath(),t.fill()},t.drawRoundRect=function(t,e,r,i,n,o,s){t.beginPath(),t.arc((e+o)*s,(r+o)*s,o*s,Math.PI,3*Math.PI/2),t.lineTo((i-o+e)*s,r*s),t.arc((i-o+e)*s,(o+r)*s,o*s,3*Math.PI/2,2*Math.PI),t.lineTo((i+e)*s,(n+r-o)*s),t.arc((i-o+e)*s,(n-o+r)*s,o*s,0,1*Math.PI/2),t.lineTo((o+e)*s,(n+r)*s),t.arc((o+e)*s,(n-o+r)*s,o*s,1*Math.PI/2,Math.PI),t.closePath()},t.drawBgText=function(t,e,r,i,n,o,s,a,l,h,f,p,d,y,g,v,m,x,w,b,L,_,T,S,A){i[0]=Math.round(i[0]),i[1]=Math.round(i[1]),t.save(),t.globalAlpha=n,t.strokeStyle=o,t.lineWidth=s,t.fillStyle=a,t.font=c.formatFont(l,1,S);var F=u.measureText(e,t.font,t),I=i[0]-F/2-h,C=i[1]-f/2-h;T&&(this.drawRoundRect(t,I,C,F+2*h,f+2*h,p,r),t.fill()),t.restore(),l=c.formatFont(l,r,S),m=c.formatFont(m,r,S),1==d&&(t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=y,t.strokeStyle=g,t.lineWidth=v,t.font=m,t.translate(i[0]*r,i[1]*r),t.strokeText(e,0,0),t.restore()),t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=x,A.hasOwnProperty("lightColor")?t.fillStyle=A.lightColor:A.hidden?t.fillStyle="#969393":t.fillStyle=w,t.font=l,t.translate(i[0]*r,i[1]*r),t.fillText(e,0,0),t.restore(),L&&(b.save(),this.setHitContextStyle(b,_),this.drawHitRoundRect(b,I,C,F+2*h,f+2*h,p),b.fill(),b.restore())},t.drawPointDefaultStyle=function(t,e,r,i,n,o,s,a){var l=e.datas[0][0];t.save(),t.fillStyle=r.pointFillStyle,t.beginPath(),t.arc(l[0],l[1],r.radius,0,2*Math.PI),t.fill(),t.restore(),a&&(s.save(),this.setHitContextStyle(s,e.id),s.beginPath(),s.arc(l[0],l[1],r.radius,0,2*Math.PI),s.fill(),s.restore())},t.drawLineDefaultStyle=function(t,e,r,i,n,o,s,a){var l=e.datas;t.save(),t.lineWidth=r.lineWidth,t.strokeStyle=r.lineFillStyle,t.beginPath(),t.moveTo(l[0][0][0],l[0][0][1]);for(var h=1;h<l.length;h++)t.lineTo(l[h][0][0],l[h][0][1]);t.stroke(),t.restore()},t.featureIdToHex=function(t){var e=Number(t)+1,r="000000"+e.toString(16),i=r.length;return r="#"+r.substring(i-6,i),r},t.setHitContextStyle=function(t,e){var r=this.featureIdToHex(e);t.globalAlpha=1,t.fillStyle=r},t.drawHitRoundRect=function(t,e,r,i,n,o){t.beginPath(),t.arc(e+o,r+o,o,Math.PI,3*Math.PI/2),t.lineTo(i-o+e,r),t.arc(i-o+e,o+r,o,3*Math.PI/2,2*Math.PI),t.lineTo(i+e,n+r-o),t.arc(i-o+e,n-o+r,o,0,1*Math.PI/2),t.lineTo(o+e,n+r),t.arc(o+e,n-o+r,o,1*Math.PI/2,Math.PI),t.closePath()},t.drawLines=function(t,e,r,i,n,o,s,a,l){var h=null;n&&(h=new Map);for(var u=0;u<e.length;u++){var c=e[u];if(2==c.type){var f=l.lineToSourceAngleData(c.sourceData);c.lines=l.transformData(f,c.xyz);var p=r[c.styleId];this.drawLineStyle(t,c,p,i,h,o,s,a)}}h=null},t.drawLineStyle=function(t,e,r,i,n,o,s,a){var l=e.lines;t.save(),t.lineWidth=r.lineWidth,t.strokeStyle=r.lineFillStyle,t.beginPath(),t.moveTo(l[0][0][0],l[0][0][1]);for(var h=1;h<l.length;h++)t.lineTo(l[h][0][0],l[h][0][1]);t.stroke(),t.restore()},t.drawAvoidBox=function(t,e,r){t.save(),t.lineWidth=1,t.strokeStyle=r?"#969393":"#2d8cf0",t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[2],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[0],e[3]),t.lineTo(e[0],e[1]),t.stroke(),t.restore()},t.sort=function(t){if(t.length>0)return t.sort(function(t,e){return!t.hidden&&e.hidden?1:t.hidden&&!e.hidden?-1:0})},t}();e.exports=f},{"../../../utils/gistools/BoxSet":53,"../../../utils/gistools/GisTools":54,"./AvoidUtil":23,"./Util":32}],28:[function(t,e,r){function i(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],e=o[1],r=o[2],this.d=e+2*r;for(var s=0;s<this.d*this.d;s++){var a=o[n+s],l=o[n+s+1];i.push(a===l?null:o.subarray(a,l))}var h=o[n+i.length],u=o[n+i.length+1];this.keys=o.subarray(h,u),this.bboxes=o.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var f=r/e*t;this.min=-f,this.max=t+f}e.exports=i;var n=3;i.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(t,e,r,i,n,o){this.cells[n].push(o)},i.prototype.query=function(t,e,r,i){var n=this.min,o=this.max;if(t<=n&&e<=n&&o<=r&&o<=i)return Array.prototype.slice.call(this.keys);var s=[],a={};return this._forEachCell(t,e,r,i,this._queryCell,s,a),s},i.prototype._queryCell=function(t,e,r,i,n,o,s){var a=this.cells[n];if(null!==a)for(var l=this.keys,h=this.bboxes,u=0;u<a.length;u++){var c=a[u];if(void 0===s[c]){var f=4*c;t<=h[f+2]&&e<=h[f+3]&&r>=h[f+0]&&i>=h[f+1]?(s[c]=!0,o.push(l[c])):s[c]=!1}}},i.prototype._forEachCell=function(t,e,r,i,n,o,s){for(var a=this._convertToCellCoord(t),l=this._convertToCellCoord(e),h=this._convertToCellCoord(r),u=this._convertToCellCoord(i),c=a;c<=h;c++)for(var f=l;f<=u;f++){var p=this.d*f+c;if(n.call(this,t,e,r,i,p,o,s))return}},i.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=n+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var o=new Int32Array(e+r+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var s=e,a=0;a<t.length;a++){var l=t[a];o[n+a]=s,o.set(l,s),s+=l.length}return o[n+t.length]=s,o.set(this.keys,s),s+=this.keys.length,o[n+t.length+1]=s,o.set(this.bboxes,s),s+=this.bboxes.length,o.buffer}},{}],29:[function(t,e,r){var i=t("./AvoidUtil"),n=t("./Util"),o=function(){function t(e,r){_classCallCheck(this,t),this.boxDistance=0,this.ctx=e,this.formatFont=r}return t.prototype.setBox=function(t,e,r){return t.forEach(function(t,i){t.hidden=!1;var n=e[t.styleId];0!=n.show?(1==t.type&&(r?this.setPointBox(t,t.datas,this.ctx,n):this.setPointBox(t,t.sourceAngleData,this.ctx,n)),2==t.type&&("text"==t.lineType&&(r?this.setTextLineBox(t,t.datas,this.ctx,n):this.setTextLineBox(t,t.sourceAngleData,this.ctx,n)),"code"==t.lineType&&(r?this.setCodeLineBox(t,t.datas,this.ctx,n):this.setCodeLineBox(t,t.sourceAngleData,this.ctx,n)),"arrow"==t.lineType&&(r?this.setArrowLineBox(t,t.datas,n):this.setArrowLineBox(t,t.sourceAngleData,n)))):t.hidden=!0}.bind(this)),this.filterFeature(t)},t.prototype.setPointBox=function(t,e,r,n){if(n.labelFunction){var o=new Function("label",n.labelFunction);try{t.label=o.call({},t.attributes[n.labelfield])}catch(e){console.warn(t.label+": 调用labelFunction失败!")}}var s=i.isNotNull(t.label);if(s||t.iconImg){var a=this.getFontWidthHeight(r,t,n,s),l=a.graphicWidth,h=a.graphicHeight,u=a.fontWidth,c=a.fontHeight,f=a.maxFontheight,p=n.pointOffsetX,d=n.pointOffsetY;p||(p=0),d||(d=0);var y=[e[0][0][0],e[0][0][1]];y[0]=y[0]+p,y[1]=y[1]+d;var g=n.pointBackgroundGap;1!=n.pointHashBackground&&(g=0);var v=n.graphicDistance;0!=h&&0!=l||(v=0),n.hasOwnProperty("direction")||(n.direction=0);var m=[],x=[];if(n.texture)if(t.label)m=this.getPointAvoidBox(y,n,v,g,l,h,u,f),x=this.getPointDrawPosition(y,n,v,g,l,h,u,c,f);else{var w=[y[0]-.5*l,y[1]-.5*c,y[0]+.5*l,y[1]+.5*c];w=this.boxScale(w,n.pointBoxDisance),m=[w],x=[[y[0],y[1]]]}else{var b=[y[0]-.5*u-g,y[1]-g-.5*f,y[0]+.5*u+g,y[1]+g+.5*f];b=this.boxScale(b,n.pointBoxDisance),m=[b];var L=[y[0]-.5*u,y[1]-.5*c+.5*n.pointHeight];x=[L]}t.boxs=m,t.box=m[0],t.fourPoints=x,t.textPoint=x[0]}else t.hidden=!0},t.prototype.getFontWidthHeight=function(t,e,r,o){var s={},a=r.graphicWidth,l=r.graphicHeight,h=e.iconImg;if(h?a&&l||(a=h.width,l=h.height):(a=0,l=0),s.graphicWidth=a,s.graphicHeight=l,s.fontWidth=a,s.fontHeight=l,o){e.label=e.label+"";var u=e.label.split(" "),c=0;t.save(),t.font=i.formatFont(r.pointStrokeFont,1,this.formatFont);for(var f=0;f<u.length;f++){var p=n.measureText(u[f].replace(/&nbsp;/g," "),t.font,t);c=p>c?p:c}t.restore(),s.fontWidth=c,s.fontHeight=r.pointHeight*u.length+2*(u.length-1),s.maxFontheight=s.fontHeight>l?s.fontHeight:l}return s},t.prototype.getPointAvoidBox=function(t,e,r,i,n,o,s,a){var l=[t[0]-.5*n,t[1]-r-.5*a,t[0]+.5*n+i+s+2*r,t[1]+.5*a+r],h=[t[0]-.5*n-i-s-2*r,l[1],t[0]+.5*n,l[3]],u=[t[0]-.5*s-r,t[1]-.5*o,t[0]+.5*s+r,t[1]+.5*o+i+2*r+a],c=[u[0],t[1]-i-2*r-a-.5*o,u[2],t[1]+.5*o];l=this.boxScale(l,e.pointBoxDisance),h=this.boxScale(h,e.pointBoxDisance),u=this.boxScale(u,e.pointBoxDisance),c=this.boxScale(c,e.pointBoxDisance);var f=[l,h,u,c];if(!e.isFourDirections&&!e.isEightDirections)return[f[e.direction]];if(e.isFourDirections){if(e.direction>0){var p=f.splice(e.direction,1);f.unshift(p[0])}return f}var d=[l[0],c[1],l[2],t[1]+.5*o],y=[l[0],t[1]-.5*o,l[2],u[3]],g=[h[0],c[1],h[2],t[1]+.5*o],v=[h[0],t[1]-.5*o,h[2],u[3]];if(f=[l,h,u,c,d,y,g,v],e.direction>0){var m=f.splice(e.direction,1);f.unshift(m[0])}return f},t.prototype.getPointDrawPosition=function(t,e,r,i,n,o,s,a,l){var h=e.pointHeight;o>h&&(h=o);var u=[t[0]+.5*n+r+i,t[1]-.5*a+.5*h],c=[t[0]-.5*n-r-i-s,t[1]-.5*a+.5*h],f=[t[0]-.5*s,t[1]+r+i+.5*h+.5*o],p=[f[0],t[1]-r-i-a+.5*h-.5*o],d=[u,c,f,p];if(!e.isFourDirections&&!e.isEightDirections)return[d[e.direction]];if(e.isFourDirections){if(e.direction>0){var y=d.splice(e.direction,1);d.unshift(y[0])}return d}var g=[u[0],p[1]],v=[u[0],f[1]],m=[c[0],p[1]],x=[c[0],f[1]];if(d=[u,c,f,p,g,v,m,x],e.direction>0){var w=d.splice(e.direction,1);d.unshift(w[0])}return d},t.prototype.setTextLineBox=function(t,e,r,i){var o=t.label,s=e;if(0!=s.length){t.textPoints=s;var a=[];if(1==i.lineHashBackground||1==s.length){var l=s[0][0];if(s.length>1){var h=Math.floor(o.length/2);l=s[h][0]}r.save(),this.formatFont?r.font=n.formatFont(i.lineFillFont,1,!0):r.font=i.lineFillFont;var u=n.measureText(t.label,r.font,r);r.restore(),i.lineBackgroundGap||(i.lineBackgroundGap=0);var c=l[0]-u/2-i.lineBackgroundGap,f=l[0]+u/2+i.lineBackgroundGap,p=l[1]-.5*i.lineHeight-i.lineBackgroundGap,d=l[1]+.5*i.lineHeight+i.lineBackgroundGap,y=[c,p,f,d];this.boxScale(y,i.lineTextBoxDisance),a.push(y)}else{if(i.lineTextRotate||0==i.lineTextRotate)for(var g=0;g<s.length;g++)s[g][1]=i.lineTextRotate;else if(this.textToSameBearing(t.angle,s),!i.isImportant&&this.isMessy(t,s,i,o))return void(t.hidden=!0);var v=this.getLineBoxs(o,s,i);if(!v)return void(t.hidden=!0);a=a.concat(v)}t.boxs=a}else t.hidden=!0},t.prototype.setCodeLineBox=function(t,e,r,i){var o=e;if(0!=o.length){var s=o[0][0];r.save(),this.formatFont?r.font=n.formatFont(i.codeLineFillFont,1,!0):r.font=i.codeLineFillFont;var a=n.measureText(t.label,r.font,r);r.restore();var l=s[0]-a/2-i.codeLineBackgroundGap,h=s[0]+a/2+i.codeLineBackgroundGap,u=s[1]-.5*i.codeLineHeight-i.codeLineBackgroundGap,c=s[1]+.5*i.codeLineHeight+i.codeLineBackgroundGap,f=[l,u,h,c];this.boxScale(f,i.lineCodeBoxDisance),t.boxs=[f],t.codePoint=s}else t.hidden=!0},t.prototype.setArrowLineBox=function(t,e,r){var i=e;if(3==i.length){var n=i[0][0],o=i[2][0],s=n[0]<o[0]?n[0]:o[0],a=n[0]>o[0]?n[0]:o[0],l=n[1]<o[1]?n[1]:o[1],h=n[1]>o[1]?n[1]:o[1],u=[s,l,a,h];this.boxScale(u,r.lineArrowBoxDisance),t.boxs=[u],t.arrowPoint=i}else t.hiden=!0},t.prototype.filterFeature=function(t){for(var e=[],r=0;r<t.length;r++)t[r].hidden||e.push(t[r]);return e},t.prototype.isMessy=function(t,e,r,i){for(var n=e[0][0],o=n[0],s=n[1],a=n[0],l=n[1],h=e[0][1],u=e[0][1],c=0;c<i.length;c++){var f=e[c][0],p=e[c][1];f[0]>a&&(a=f[0]),f[0]<o&&(o=f[0]),f[1]>l&&(l=f[1]),f[1]<s&&(s=f[1]),p>u&&(u=p),p<h&&(h=p)}if(u-h>r.angle){if(0!=r.angleSwitch||!r.angleColor)return!0;t.lineFillStyle=r.angleColor}return!1},t.prototype.getLineBoxs=function(t,e,r){for(var i=[],n=[],o=0;o<t.length;o++){var s=e[o][0];0==e[o][1]&&(e[o][1]=.5);var a=[s[0]-1.2*r.lineHeight*.5,s[1]-1.2*r.lineHeight*.5,s[0]+1.2*r.lineHeight*.5,s[1]+1.2*r.lineHeight*.5];this.boxScale(a,r.lineTextBoxDisance);var l=[s[0]-.5*r.lineHeight,s[1]-1.2*r.lineHeight*.5,s[0]+.5*r.lineHeight,s[1]+.5*r.lineHeight];n.push(l),i.push(a)}if(!r.isImportant)for(var h=0;h<n.length-1;h++)for(var u=n[h],c=h+1;c<n.length;c++){var f=n[c];if(this.crashBox(u,f))return null}return i},t.prototype.boxScale=function(t,e){return e||0==e||(e=this.boxDistance),t[0]=t[0]-.5*e,t[1]=t[1]-.5*e,t[2]=t[2]+.5*e,t[3]=t[3]+.5*e,t},t.prototype.crashBox=function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]},t.prototype.textToSameBearing=function(t,e){t>=45?t-=90:t<=-45&&(t+=90);for(var r=0;r<e.length;r++){var i=e[r][1],n=t-i;n>45&&(e[r][1]=i+90),n<-45&&(e[r][1]=i-90)}},t}();e.exports=o},{"./AvoidUtil":23,"./Util":32}],30:[function(t,e,r){
var i=t("./../../../utils/gistools/GridFilter"),n=t("./Util"),o=t("../../../utils/gistools/GisTools"),s=function(){function t(){_classCallCheck(this,t)}return t.fristFilter=function(e,r,i,o,s,a,l,h,u){return o&&s&&(n.sort(e),n.sort(r)),e=t.fristFilterStart(e,a,l,h,u),r=t.fristFilterStart(r,a,l,h,u),{pointFeatures:e,lineFeatures:r}},t.scendFilter=function(e,r,i,o,s,a,l,h,u){o&&s&&(n.sort(e),n.sort(r)),e=t.scendFilterStart(e,a,16,h),r=t.scendFilterStart(r,a,16,h);var c=[];return c=c.concat(e),c=c.concat(r),c},t.removeTileOutPointFeatures=function(t,e){for(var r=[],i=0;i<t.length;i++){var n=t[i],o=n.centerPoint;o&&o[0]>=0&&o[0]<=e&&o[1]>=0&&o[1]<=e&&r.push(n)}return r},t.removeTileOutLineFeatures=function(t,e){for(var r=[],i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.datas.length;o++){var s=n.datas[o][0];if(s[0]>=0&&s[0]<=e&&s[1]>=0&&s[1]<=e){r.push(n);break}}return r},t.fristFilterStart=function(t,e,r,n,o){for(var s=new i(e,r,n,o),a=[],l=0;l<t.length;l++){var h=t[l],u=s.filter(h.centerPoint[0],h.centerPoint[1]);u&&a.push(h)}return a},t.scendFilterStart=function(t,e,r,n){for(var o=new i(e,r,n,1),s=[],a=0;a<t.length;a++){var l=t[a],h=o.filterByBox(l.filterBox);h&&s.push(l)}return s},t.threeFilter=function(e,r,i){var s=t.getImportantOtherFeatures(e,r),a=n.groupByLabel(s.otherFeatures),l=[],h=[0,0,i,i];for(var u in a){var c=a[u];if(1==c.length)l.push(c[0]);else{for(var f=[],p=0;p<c.length;p++){var d=c[p];if(1==d.type&&(o.isInBox(d.box,h)?f.push(d):l.push(d)),2==d.type){for(var y=!0,g=0;g<d.boxs.length;g++){var v=d.boxs[g];if(!o.isInBox(v,h)){y=!1;break}}y?f.push(d):l.push(d)}}f.length>0&&(f=n.sortPrimaryId(f),l=l.concat(t.distinctFeatures(f,r)))}}return l=l.concat(s.importantFeatures),l},t.distinctFeatures=function(e,r){var i=e[0],n="";1==i.type&&(n="distance"),2==i.type&&("text"==i.lineType&&(n="lineTextDistance"),"code"==i.lineType&&(n="lineCodeDistance"));var o=[];o.push(e[0]);for(var s=0;s<e.length-1;s++){var a=e[s];if(1!=a.hidden){var l=e[s+1],h=t.getDistance(a.centerPoint,l.centerPoint),u=r[a.styleId],c=u[n]?u[n]:0;h<c?l.hidden=!0:o.push(l)}}return o},t.getDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.pow(r*r+i*i,.5)},t.getImportantOtherFeatures=function(t,e){for(var r=[],i=[],n=0;n<t.length;n++){var o=t[n],s=e[o.styleId];s.isImportant?r.push(o):i.push(o)}return{otherFeatures:i,importantFeatures:r}},t}();e.exports=s},{"../../../utils/gistools/GisTools":54,"./../../../utils/gistools/GridFilter":55,"./Util":32}],31:[function(t,e,r){var i=t("./GCutLine"),n=t("./AvoidUtil"),o="./../../../../",s=null,a=function(){function e(){_classCallCheck(this,e)}return e.parseLayerDatas=function(t,r,i,n,o,s,a,l){var h=[],u=[];for(var c in t)if("_layerAvoids"!=c){var f=t[c];f.xyz=i;var p=e.getProperty(f.fieldsConfig);if(1==f.type){var d=e.parsePointLayer(f,c,p,r,n,o,s,a,l);h=h.concat(d)}if(2==f.type){var y=e.parseLineLayer(f,c,p,r,n,o,s,a,l);u=u.concat(y)}}return{pointFeatures:h,lineFeatures:u}},e.updateFeatureAttr=function(r,i,n,a,l,h,u,c,f){for(var p=0;p<r.length;p++){var d=r[p],y=i[d.styleId];if(l)d.iconImg=a[y.texture];else if(null==s&&(s=t(o+"src/process/texture/TextureManager")),y.texture){var g=s.getTexture(y.texture);null!=g&&(d.iconImg=g.toPattern(n))}e.parsePoint(d,y,l,h,u,c,f)}return r},e.parsePointLayer=function(t,e,r,i,n,o,s,a,l){for(var h=[],u=0;u<t.features.length;u++){var c=t.features[u],f=i[c.styleId];f&&f.show&&("_default__"==f.type||f.labelfield||f.texture)&&(c.centerPoint=c[2],c.attributeId=e+"__"+c[1][r.idIndex],c.layerName=e,c.xyz=t.xyz,c.propertyGetter=r,c.type=t.type,c.weight=c.avoidWeight,(null==c.avoidWeight||isNaN(c.avoidWeight))&&(c.avoidWeight=f.avoidWeight,c.weight=c.avoidWeight,null==c.weight&&(c.weight=0,c.avoidWeight=0)),f.isImportant&&(c.avoidWeight=99999999,c.weight=99999999),h.push(c))}return h},e.parseLineLayer=function(t,r,i,n,o,s,a,l,h){for(var u=[],c=0;c<t.features.length;c++){var f=t.features[c],p=n[f.styleId];if(p&&p.show&&("_default__"==p.type||p.labelfield||p.roadCodeLabel)){f.layerName=r;var d=e.parseLine(f,p,t,i,o,s,a,l,h);u=u.concat(d)}}return u},e.parsePoint=function(t,r,i,o,s,a,l){t.attributes=e.getAttributes(t[1],t.propertyGetter);var h=t[2],u=[[h,0]],c=t.attributes[r.labelfield];t.primaryId=t.attributeId+"_row_"+t.xyz.y+"_col_"+t.xyz.x+"_level_"+t.xyz.l+"_x_"+u[0][0][0]+"_y_"+u[0][0][1],t.label=n.formatLabel(c),t.weight=t.avoidWeight;var f=0;return r.pointBoxDisance&&(f=.5*r.pointBoxDisance),r.pointOffsetX||(r.pointOffsetX=0),r.pointOffsetY||(r.pointOffsetY=0),t.filterBox=[t.centerPoint[0]+r.pointOffsetX-f,t.centerPoint[1]+r.pointOffsetY-f,t.centerPoint[0]+r.pointOffsetX+f,t.centerPoint[1]+r.pointOffsetY+f],t.sourceData=h,t.sourceAngleData=u,i?(t.id=Math.round(256*Math.random()*256*256),t.datas=e.transformData(u,t.xyz,o,s,a,l)):t.datas=u,t},e.parseLine=function(t,r,i,n,o,s,a,l,h){if(0==t[2].length)return[];var u=[];return e.processLineString(u,t[2],t,r,i,n,o,s,a,l,h),u},e.processLineString=function(t,r,i,n,o,s,a,l,h,u,c){if(Array.isArray(r[0]))for(var f=r.length,p=0;p<f;p++){var d=r[p];e.processLineString(t,d,i,n,o,s,a,l,h,u,c)}else for(var y=e.parseMultiLine(i,r,o,s,n,a,l,h,u,c),g=0;g<y.length;g++)t.push(y[g])},e.parseMultiLine=function(t,r,i,o,s,a,l,h,u,c){var f=e.getAttributes(t[1],o),p=[],d=f[s.labelfield],y=f[s.roadCodeLabel];d=n.formatLabel(d),y=n.formatLabel(y);var g=t.layerName+"__"+t[1][o.idIndex];t.avoidWeight;s.isImportant;var v={type:i.type,sourceData:r,label:d,weight:t.avoidWeight,codeAvoidWeight:t.codeAvoidWeight,arrowAvoidWeight:t.arrowAvoidWeight,roadCodeLabel:y,attributes:f,attributeId:g,styleId:t.styleId,xyz:i.xyz,layerName:t.layerName};return p=p.concat(e.cutLineFeature(v,s,a,!1,l,h,u,c)),p},e.cutLineFeature=function(t,r,n,o,s,a,l,h){if(n&&"_default__"==r.type)return t.sourceAngleData=e.lineToSourceAngleData(t.sourceData),t.datas=e.transformData(t.sourceAngleData,t.xyz,s,a,l,h),[t];for(var u=i.cutLineFeature(t,r,n),c=.1,f=0;f<u.length;f++){var p=u[f];if(p.primaryId=p.attributeId+"_row_"+t.xyz.y+"_col_"+t.xyz.x+"_level_"+t.xyz.l+"_x_"+p.sourceAngleData[0][0][0]+"_y_"+p.sourceAngleData[0][0][1],n?(p.datas=o?t.transformData(this.extent,this.res):e.transformData(p.sourceAngleData,p.xyz,s,a,l,h),p.id=Math.round(256*Math.random()*256*256)):p.datas=p.sourceAngleData,p.layerName=t.layerName,"text"==p.lineType){var d=Math.floor(p.sourceAngleData.length/2);p.centerPoint=p.sourceAngleData[d][0],r.lineTextBoxDisance&&(c=.5*r.lineTextBoxDisance)}"code"==p.lineType&&(p.centerPoint=p.sourceAngleData[0][0],r.lineCodeBoxDisance&&(c=.5*r.lineCodeBoxDisance)),"arrow"==p.lineType&&(p.centerPoint=p.sourceAngleData[1][0]),p.filterBox=[p.centerPoint[0]-c,p.centerPoint[1]-c,p.centerPoint[0]+c,p.centerPoint[1]+c]}return u},e.lineToSourceAngleData=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n=t[r+1];e.push([[i,n],0]),r++}return e},e.transformData=function(t,e,r,i,n,o){for(var s=i[0],a=i[3],l=r[0],h=r[3],u=(s-l)/n,c=(h-a)/n,f=[],p=0;p<t.length;p++){var d=t[p][0],y=d[0]+e.x*o,g=d[1]+e.y*o,v=[y-u,g-c];f.push([v,t[p][1]])}return f},e.parseAvoidLine=function(t,r,i,n,o,s,a){var l=[];for(var h in t){var u=t[h];h=parseInt(h);for(var c=0;c<u.length;c++){var f={};f.weight=h,f.sourceDatas=u[c],i&&(f.datas=e.transformAvoidLine(u[c],r,n,o,s,a)),f.xyz=r,l.push(f)}}return l},e.transformAvoidLine=function(t,e,r,i,n,o){for(var s=i[0],a=i[3],l=r[0],h=r[3],u=(s-l)/n,c=(h-a)/n,f=[],p=0;p<t.length/2;p++){var d=t[2*p],y=t[2*p+1],g=d+e.x*o,v=y+e.y*o;f.push(g-u),f.push(v-c)}return f},e.getProperty=function(t){for(var e={},r=0,i=0;i<t.length;i++)"true"!=t[i].id&&1!=t[i].id||(r=t[i].index),e[t[i].name]=parseInt(t[i].index);return{propertyConfig:e,idIndex:r}},e.getAttributes=function(t,e){var r={},i=e.propertyConfig;for(var n in i)r[n]=t[i[n]];return r},e}();e.exports=a},{"./AvoidUtil":23,"./GCutLine":25}],32:[function(t,e,r){var i=function(){function t(){_classCallCheck(this,t)}return t.measureText=function(t,e,r){return r.measureText(t).width},t.sort=function(t,e,r){if(t.length>0)return t.sort(function(t,i){if(r){var n=e[t.styleId]?e[t.styleId]:t.style,o=e[i.styleId]?e[i.styleId]:i.style;if(n.isImportant&&!o.isImportant)return-1;if(o.isImportant&&!n.isImportant)return 1}var s=t.weight,a=i.weight,l=t.primaryId,h=i.primaryId,u=t._sort,c=i._sort;return null==u&&(u=-1),null==c&&(c=-1),s||(s=-1),a||(a=-1),s<a?1:s==a?u>c?1:u<c?-1:l<h?1:-1:-1}.bind(this))},t.sortPrimaryId=function(t){if(t.length>0)return t.sort(function(t,e){var r=t.weight,i=e.weight,n=t.primaryId,o=e.primaryId;return r||(r=-1),i||(i=-1),r<i?1:r==i&&n<o?1:-1}.bind(this))},t.groupByLabel=function(t){for(var e={},r=0;r<t.length;r++){var i=t[r];null==i.label&&null!=i.iconImg?(null==e[i.attributeId]&&(e[i.attributeId]=[]),e[i.attributeId].push(i)):(e[i.type+"_"+i.label]||(e[i.type+"_"+i.label]=[]),e[i.type+"_"+i.label].push(i))}return e},t}();e.exports=i},{}],33:[function(t,e,r){(function(r){(function(){var i=t("../../../utils/Cache"),n=t("../avoid/GDrawGeomerty"),o=t("./../../../utils/es6-promise"),s=o.getParamJSON,a=o.getBufferData,l=t("./LabelDrawer"),h=t("./../../../utils/gistools/GisTools"),u=t("./../avoid/GAnnoAvoid"),c=t("./../avoid/ParseLabelData"),f=t("./../avoid/GridFilterLabel"),p=t("./../VarintReader"),d=function(){function t(){_classCallCheck(this,t),this.width=0,this.height=0,this.grid=[],this.cache=new i(256),this.gwvtAnno=null,this.dataSource=[],this.isReady=!1,this.maxExtent=[],this.extent=[],this.res=0,this.tileSize=512,this.hitDetection=!1,this.features=[],this.requestingTiles={},this.hasImportant=!0,this.ratio=1;var e=document.createElement("CANVAS");this.ctx=e.getContext("2d",{isQuality:!0}),this.ableAvoid=!0,this.ableWeight=!0,this.cellsize=4,this.maxPerCell=1,this.styleMap={},this.debug=!1,this.GAnnoAvoid=new u(this.ctx,!1,this.debug),this.highlightLabels={}}return t.prototype.setDebug=function(t){this.debug=t,this.GAnnoAvoid=new u(this.ctx,!1,this.debug)},t.prototype.init=function(t,e,r,i){this.tileSize=r,this.gwvtAnno=i,this.cellsize=i.cellsize,this.initCanvas(t,e),this.loadResources()},t.prototype.loadResources=function(){if(0!=this.dataSource.length){this.cache.clean(),this.requestingTiles={};for(var t=[],e=0;e<this.dataSource.length;e++){var r=this.dataSource[e];"URLDataSource"==r.type&&(t=t.concat(r.loadStyle())),"LocalDataSource"==r.type&&(t=t.concat(r.loadTexture()))}t.length>0?Promise.all(t).then(function(){this.isReady=!0,this.grid.length>0&&this.requestLabelTiles(this.grid)}.bind(this)):this.isReady=!0}else this.isReady=!1},t.prototype.initCanvas=function(t,e){this.width=t,this.height=e,this.root||(this.root=document.createElement("canvas")),this.root.style.width=this.width+"px",this.root.style.height=this.height+"px",this.root.width=this.width*this.ratio,this.root.height=this.height*this.ratio,this.root.id="labelCanvas",this.canvas=this.root.getContext("2d",{isQuality:!0}),this.hitDetection&&(this.hitCanvas||(this.hitCanvas=document.createElement("canvas")),this.hitCanvas.style.width=this.width+"px",this.hitCanvas.style.height=this.height+"px",this.hitCanvas.width=this.width,this.hitCanvas.height=this.height,this.hitContext=this.hitCanvas.getContext("2d",{isQuality:!0}))},t.prototype.addDataSource=function(t){"URLDataSource"==t.type&&(t.url=t.url+"&tilesize="+this.tileSize,t.loadServerInfo()),"URLDataSource"!=t.type&&"LocalDataSource"!=t.type||this.dataSource.push(t)},t.prototype.removeDataSourceById=function(t){for(var e=0;e<this.dataSource.length;e++)if(this.dataSource[e].id==t)return void this.dataSource.splice(e,1)},t.prototype.getDataSourceById=function(t){for(var e=0;e<this.dataSource.length;e++)if(this.dataSource[e].id==t)return this.dataSource[e]},t.prototype.clean=function(){this.canvas.clearRect(0,0,this.width*this.ratio,this.height*this.ratio),this.hitContext&&this.hitContext.clearRect(0,0,this.width,this.height)},t.prototype.redraw=function(){0!=this.grid.length&&(this.styleMap={},this.loadResources())},t.prototype.requestLabelTiles=function(t,e){if(this.grid=t,this.isReady){var r=this.getRequestTileUrls(t);this.sendRequest(r)}},t.prototype.getLocalLabelDatas=function(){for(var t=[],e=0;e<this.dataSource.length;e++){var r=this.dataSource[e];if("LocalDataSource"==r.type)for(var i=0;i<r.features.length;i++){var n=r.features[i];n.inBounds(this.extent)&&(n.attributeId=n.attributes.attributeId,n.primaryId=n.attributeId,1==n.type&&(n.sourceAngleData=[[n.sourceData,0]],n.transformData(this.extent,this.res),n.label=n.getFeatureLabel(),n.iconImg=r.textures[n.style.texture],t.push(n)),2==n.type&&(n.label=n.getFeatureLabel(),n.textures=r.textures,t=t.concat(this.cutLineFeature(n,!0))))}}return t},t.prototype.getRequestTileUrls=function(t){this.hitCacheUrls=[],this.currentTileDatas=[],this.defaultStyeTileDatas=[];for(var e={},r={},i=0;i<this.dataSource.length;i++){var n=this.dataSource[i];if("URLDataSource"==n.type)for(var o=n.url,s=0;s<t.length;s++){var a=t[s],l=o.replace("${x}",a.col).replace("{x}",a.col);if(l=l.replace("${y}",a.row).replace("{y}",a.row),l=l.replace("${z}",a.level).replace("{z}",a.level),n.urlArray.length>0){var h=n.urlArray.length-1,u=Math.round(Math.random()*h),c=n.urlArray[u],f=l.split("/mapserver"),p=f[1];l=c+"/mapserver"+p}var d=this.cache.getItem(l);d?this.hitCacheUrls.push({url:l,isDefaultStyle:"_default__"==n.styleId}):this.requestingTiles[l]?r[l]=!0:e[l]={url:l,xyz:a,dataSourceId:n.id,dataType:n.newEngine?"arraybuffer":"json"}}}return this.cancelRequest(r),e},t.prototype.cancelRequest=function(t){for(var e in this.requestingTiles)if(!t[e]){var r=this.requestingTiles[e];delete this.requestingTiles[e],r.xhr.abort(),r.requestItem.cancel=!0}},t.prototype.sendRequest=function(t){var e=0;for(var r in t){var i=t[r],n=null;"json"==i.dataType?n=s(i):"arraybuffer"==i.dataType&&(n=a(i)),this.requestingTiles[i.url]={xhr:n.xhr,requestItem:i},n.then(this.tileSuccessFunction.bind(this),this.tileFailFunction.bind(this)),e++}0==e&&this.sendSuccess([],[])},t.prototype.toBuffer=function(t){for(var e=new r(t.byteLength),i=new Uint8Array(t),n=0;n<e.length;++n)e[n]=i[n];return e},t.prototype.Utf8ArrayToStr=function(t){var e,r,i,n,o,s;for(e="",i=t.length,r=0;r<i;)switch(n=t[r++],n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:o=t[r++],e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t[r++],s=t[r++],e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return e},t.prototype.tileSuccessFunction=function(t){if(1!=t.param.cancel&&!this.isEmptyObject(this.requestingTiles)){var e=t.param.url;delete this.requestingTiles[e];var r=t.param.dataSourceId,i=this.getDataSourceById(r),n=null;if(i&&i.newEngine){var o=h.toBuffer(t.data),s={param:t.param,tileData:{}};if(o.byteLength>0){for(var a=new p(o,4,i.layerFieldMap),l=a.getAllLayerNames(),u=0;u<l.length;u++)l[u].indexOf("layerAvoids_")>-1?s.tileData[l[u]]={geometryType:a.getGeometryType(l[u]),props:a.getAllCoordinates(l[u],10)}:s.tileData[l[u]]={geometryType:a.getGeometryType(l[u]),props:a.getLayerPro(l[u])};s.vant=a}n=this.parseFeature(s,i)}else n=this.parseFeature(t,i);var d=[];null!=n.styleId?("_default__"==n.styleId?(c.updateFeatureAttr(n.pointFeatures,this.styleMap,this.ratio,{},!0,this.maxExtent,this.extent,this.res,this.tileSize),d=d.concat(n.lineFeatures),d=d.concat(n.pointFeatures),this.defaultStyeTileDatas.push({url:e,labelFeatures:d,avoidLineFeatures:n.avoidLineFeatures})):(this.ableAvoid?(d=f.fristFilter(n.pointFeatures,n.lineFeatures,this.styleMap,this.ableWeight,!0,this.tileSize,this.cellsize,1*this.tileSize,this.maxPerCell),c.updateFeatureAttr(d.pointFeatures,this.styleMap,this.ratio,i.textures,!0,this.maxExtent,this.extent,this.res,this.tileSize),d=f.scendFilter(d.pointFeatures,d.lineFeatures,this.styleMap,this.ableWeight,!0,this.tileSize,this.cellsize,1*this.tileSize),d=this.GAnnoAvoid.GLabelBox.setBox(d,this.styleMap,!1),n.avoidLineFeatures.length>0&&(d=this.GAnnoAvoid.avoid(d,this.styleMap,n.avoidLineFeatures))):(c.updateFeatureAttr(n.pointFeatures,this.styleMap,this.ratio,i.textures,!0,this.maxExtent,this.extent,this.res,this.tileSize),d=n.pointFeatures.concat(n.lineFeatures)),this.currentTileDatas.push({url:e,labelFeatures:d,avoidLineFeatures:n.avoidLineFeatures})),this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas,this.defaultStyeTileDatas)):this.currentTileDatas.push({url:e,labelFeatures:[],avoidLineFeatures:n.avoidLineFeatures})}},t.prototype.isEmptyObject=function(t){for(var e in t)return!1;return!0},t.prototype.tileFailFunction=function(t){if(1!=t.param.cancel&&!this.isEmptyObject(this.requestingTiles)){var e=t.param.url;delete this.requestingTiles[e],this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas,this.defaultStyeTileDatas)}},t.prototype.sendSuccess=function(t,e){this.gwvtAnno.animating||(this.gwvtAnno.resetCanvasDiv(),this.clean(),this.hitDetection&&(this.features=[]),this.drawLabel(t),this.drawDefaultStyleLabel(e))},t.prototype.drawDefaultStyleLabel=function(t){for(var e=this.mergeLabelData(t,this.hitCacheUrls,!0),r=e.labelFeatures,i=0;i<t.length;i++){var o=t[i];this.cache.push(o.url,o)}if(this.hitDetection)for(var s=0;s<r.length;s++){var a=r[s];this.features[a.id]=a}n.drawDefaultStyle(this.canvas,r,this.styleMap,this.ratio,!1,!1,this.hitContext,this.hitDetection)},t.prototype.drawLabel=function(t){for(var e=this.mergeLabelData(t,this.hitCacheUrls,!1),r=e.labelFeatures,i=0;i<t.length;i++){var o=t[i];this.cache.push(o.url,o)}var s=this.getLocalLabelDatas();r=r.concat(s),r=this.GAnnoAvoid.GLabelBox.setBox(r,this.styleMap,!0);var a=r;if(this.ableAvoid&&(a=this.GAnnoAvoid.defaultAvoid(r,this.styleMap,!0,this.hasImportant,this.ableWeight)),this.hitDetection)for(var l=0;l<a.length;l++){var h=a[l];this.features[h.id]=h}n.draw(this.canvas,a,this.styleMap,this.ratio,!1,!1,this.hitContext,this.hitDetection,!1,this.debug)},t.prototype.drawAvoidLine=function(t){this.canvas.save(),this.canvas.beginPath();for(var e=0;e<t.length;e++){var r=t[e];this.canvas.lineWidth=1,this.canvas.strokeStyle="#fff000",this.canvas.moveTo(r.datas[0],r.datas[1]);for(var i=1;i<r.datas.length/2;i++)this.canvas.lineTo(r.datas[2*i],r.datas[2*i+1])}this.canvas.stroke(),this.canvas.restore()},t.prototype.parseFeature=function(t,e){var r={};if(e&&e.newEngine){var i=t.tileData;for(var n in i){var o=n.indexOf("layerAvoids_");if(o>-1){var s=n.substring(o+12);r._layerAvoids?r._layerAvoids[s]=i[n].props:(r._layerAvoids={},r._layerAvoids[s]=i[n].props)}else if(r[n]={features:[],fieldsConfig:e.serverInfo[n]?e.serverInfo[n].fieldsConfig:{},serverId:e.servername,type:1},"point"==i[n].geometryType.toLowerCase()?r[n].type=1:"line"!=i[n].geometryType.toLowerCase()&&"linestring"!=i[n].geometryType.toLowerCase()&&"multilinestring"!=i[n].geometryType.toLowerCase()||(r[n].type=2),i[n].props&&i[n].props.length>0)for(var a=0;a<i[n].props.length;a++){var h=[];h.push(i[n].geometryType),h.push(i[n].props[a]),h.push(t.vant.getCoordinatesByIndex(n,a,10)),r[n].features.push(h)}}}else r=t.data;var u={x:t.param.xyz.col,y:t.param.xyz.row,l:t.param.xyz.level},p=0;for(var d in r){r[d];p++}var y={pointFeatures:[],lineFeatures:[],pointImportantFeatures:[],lineImportantFeatures:[]};if(p>0&&e&&e.styleFun){var g=u.l;if(e.newEngine){var v=new l(r,this.styleMap,g,e.foreendFont);e.styleFun.call({},v,g)}else{var m=new l(r,this.styleMap,g,e.foreendFont);e.styleFun.call({},m,g)}y=c.parseLayerDatas(r,this.styleMap,u,!0,this.maxExtent,this.extent,this.res,this.tileSize)}var x=c.parseAvoidLine(r._layerAvoids,u,!0,this.maxExtent,this.extent,this.res,this.tileSize),w=f.removeTileOutPointFeatures(y.pointFeatures,this.tileSize),b=y.lineFeatures,L=e?e.styleId:null;return{styleId:L,pointFeatures:w,lineFeatures:b,avoidLineFeatures:x}},t.prototype.setGlobalStyle=function(t){this.ableAvoid=!t.disableAvoid,this.ableWeight=!t.disableWeight,this.boxDistance=t.boxDistance},t.prototype.mergeLabelData=function(t,e,r){for(var i=[],n=[],o=0;o<t.length;o++){var s=t[o];i=i.concat(s.labelFeatures),n=n.concat(s.avoidLineFeatures)}for(var a=[],l=0;l<e.length;l++){var h=e[l];h.isDefaultStyle==r&&a.push(h.url)}for(var u=0;u<a.length;u++){for(var f=this.cache.getItem(a[u]).labelFeatures,p=0;p<f.length;p++){var d=f[p];d.datas=c.transformData(d.sourceAngleData,d.xyz,this.maxExtent,this.extent,this.res,this.tileSize)}i=i.concat(f);for(var y=this.cache.getItem(a[u]).avoidLineFeatures,g=0;g<y.length;g++){var v=y[g];v.datas=c.transformAvoidLine(v.sourceDatas,v.xyz,this.maxExtent,this.extent,this.res,this.tileSize)}n=n.concat(y)}return{labelFeatures:i,avoidLineFeatures:n}},t.prototype.getFeatureByXY=function(t,e){var r=null;if(this.hitDetection){var i=void 0,n=this.hitContext.getImageData(t,e,1,1).data;if(255===n[3]){var o=n[2]+256*(n[1]+256*n[0]);if(o){i=o-1;try{r=this.features[i]}catch(t){}}}}return r},t.prototype.getFeaturesByXY=function(t,e){var r=[];for(var i in this.features){var n=this.features[i];if(1==n.type&&this.isInBox(t,e,n.box))r.push(n);else if(2==n.type)for(var o=0;o<n.boxs.length;o++){var s=n.boxs[o];if(this.isInBox(t,e,s)){r.push(n);break}}}return r},t.prototype.lineToSourceAngleData=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n=t[r+1];e.push([[i,n],0]),r++}return e},t.prototype.transformData=function(t,e){for(var r=this.extent[0],i=this.extent[3],n=this.maxExtent[0],o=this.maxExtent[3],s=(r-n)/this.res,a=(o-i)/this.res,l=[],h=0;h<t.length;h++){var u=t[h][0],c=u[0]+e.x*this.tileSize,f=u[1]+e.y*this.tileSize,p=[c-s,f-a];l.push([p,t[h][1]])}return l},t.prototype.isInBox=function(t,e,r){return t>r[0]&&t<r[2]&&e>r[1]&&e<r[3]},t.prototype.highlightLabel=function(t,e){for(var r in this.highlightLabels){var i=this.highlightLabels[r];delete i.lightColor}this.highlightLabels={};for(var n=0;n<t.length;n++){var o=t[n],s=this.features[o];s.lightColor=e,this.highlightLabels[o]=s}},t}();e.exports=d}).call(this)}).call(this,t("buffer").Buffer)},{"../../../utils/Cache":50,"../avoid/GDrawGeomerty":27,"./../../../utils/es6-promise":52,"./../../../utils/gistools/GisTools":54,"./../VarintReader":22,"./../avoid/GAnnoAvoid":24,"./../avoid/GridFilterLabel":30,"./../avoid/ParseLabelData":31,"./LabelDrawer":34,buffer:2}],34:[function(t,e,r){var i=function(){function t(e,r,i,n){_classCallCheck(this,t),this.layerDataMap=e,this.level=i,this.styleMap=r,this.propertyGetterMap={},this.foreendFont=n}return t.prototype.getLayer=function(t){this.layerDatas={};var e=this.layerDataMap[t];return null==e||null==e.features?this:(this.propertyGetterMap[t]=this.getProperty(e.fieldsConfig),this.layerDatas[t]=e,this)},t.prototype.getAllLayer=function(){for(var t in this.layerDatas=this.layerDataMap,this.layerDataMap)this.propertyGetterMap[t]=this.getProperty(this.layerDataMap[t].fieldsConfig);return this},t.prototype.getGroupLayer=function(t,e){this.layerDatas={};var r=e.split(","),i=r.length;if(0==i)return this;var n=this.layerDataMap[t];return null==n||null==n.features?this:(this.propertyGetterMap[t]=this.getProperty(n.fieldsConfig),this.layerDatas[t]=n,this)},t.prototype.getProperty=function(t){for(var e={},r={},i=0,n=0;n<t.length;n++)"true"!=t[n].id&&1!=t[n].id||(i=t[n].index),e[t[n].name]=parseInt(t[n].index),r[t[n].name]=t[n].type;return{propertyConfig:e,idIndex:i,propertyTypes:r}},t.prototype.setStyle=function(t){var e=this,r=function(r){for(var i=e.layerDatas[r],o=e.propertyGetterMap[r],s=function(r){var s=i.features[r],a=function(t){if(o.propertyTypes[t].toLowerCase().indexOf("integer")>-1||o.propertyTypes[t].toLowerCase().indexOf("float")>-1||o.propertyTypes[t].toLowerCase().indexOf("int")>-1||o.propertyTypes[t].toLowerCase().indexOf("double")>-1||o.propertyTypes[t].toLowerCase().indexOf("bigdecimal")>-1)return Number(s[1][o.propertyConfig[t]]);if(o.propertyTypes[t].toLowerCase().indexOf("timestamp")>-1){var e=s[1][o.propertyConfig[t]],r=new RegExp("^\\d{1,13}$");r.test(e)&&(e=Number(e));var i=new Date(e);return e=i.getTime(),e}return s[1][o.propertyConfig[t]]},l=t.call({},e.level,a);l&&1==l.show&&(e.styleMap[l._id]||(e.styleMap[l._id]=l),s.avoidWeight=e.getWeight(l,s,o,"avoidWeight","avoidField"),e.foreendFont&&(l.lineStrokeFont&&(n=l.lineStrokeFont,n.indexOf(",")>-1?l.lineStrokeFont=n.split(",")[0]+","+e.foreendFont:l.lineStrokeFont=n+","+e.foreendFont),l.codeLineFillFont&&(n=l.codeLineFillFont,n.indexOf(",")>-1?l.codeLineFillFont=n.split(",")[0]+","+e.foreendFont:l.codeLineFillFont=n+","+e.foreendFont),l.lineFillFont&&(n=l.lineFillFont,n.indexOf(",")>-1?l.lineFillFont=n.split(",")[0]+","+e.foreendFont:l.lineFillFont=n+","+e.foreendFont),l.pointFillFont&&(n=l.pointFillFont,n.indexOf(",")>-1?l.pointFillFont=n.split(",")[0]+","+e.foreendFont:l.pointFillFont=n+","+e.foreendFont),l.pointStrokeFont&&(n=l.pointStrokeFont,n.indexOf(",")>-1?l.pointStrokeFont=n.split(",")[0]+","+e.foreendFont:l.pointStrokeFont=n+","+e.foreendFont)),"POINT"!=s[0]&&(l.hasOwnProperty("codeAvoidWeight")&&l.hasOwnProperty("codeAvoidField")?(s.codeAvoidWeight=e.getWeight(l,s,o,"codeAvoidWeight","codeAvoidField"),s.codeAvoidWeight=s.codeAvoidWeight==s.avoidWeight?s.avoidWeight+1:s.codeAvoidWeight):s.codeAvoidWeight=s.avoidWeight+1,l.hasOwnProperty("arrowAvoidWeight")&&l.hasOwnProperty("arrowAvoidField")?(s.arrowAvoidWeight=e.getWeight(l,s,o,"arrowAvoidWeight","arrowAvoidField"),s.arrowAvoidWeight=s.arrowAvoidWeight==s.avoidWeight?s.avoidWeight-1:s.arrowAvoidWeight,s.arrowAvoidWeight=s.arrowAvoidWeight==s.codeAvoidWeight?s.codeAvoidWeight-1:s.arrowAvoidWeight):s.arrowAvoidWeight=s.avoidWeight-1),s.styleId=l._id)},a=0;a<i.features.length;a++)s(a)};for(var i in this.layerDatas){var n;r(i)}},t.prototype.setGlobalStyle=function(t){this.globalStyle=t.call({})},t.prototype.getWeight=function(t,e,r,i,n){var o=e[1][r.propertyConfig[t[n]]];return o?(o=parseInt(o),isNaN(o)&&(o=0)):o=0,0==o&&t[i]?t[i]:o},t.prototype.draw=function(){},t}();e.exports=i},{}],35:[function(t,e,r){var i=function(){function t(){_classCallCheck(this,t),this.id=Math.round(256*Math.random()*256*256),this.type=1,this.sourceData=[],this.datas=[],this.sourceAngleData=[],this.attributes={},this.style={}}return t.prototype.addAttribute=function(t,e){this.attributes[t]=e},t.prototype.removeAttributeByKey=function(t){delete this.attributes[t]},t.prototype.getMaxExtent=function(){if(0==this.sourceData.length)return null;for(var t=this.sourceData[0],e=this.sourceData[0],r=this.sourceData[1],i=this.sourceData[1],n=2;n<this.sourceData.length;n++){var o=this.sourceData[n],s=this.sourceData[n+1];o>e&&(e=o),o<t&&(t=o),s>i&&(i=s),s<r&&(r=s),n++}return[t,r,e,i]},t.prototype.inBounds=function(t){var e=this.getMaxExtent();return!!e&&(e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1])},t.prototype.transformData=function(t,e){if(this.datas=[],0!=this.sourceData.length){for(var r=t[0],i=t[3],n=[],o=0;o<this.sourceAngleData.length;o++){var s=this.sourceAngleData[o][0],a=(s[0]-r)/e,l=(i-s[1])/e,h=[a,l];n.push([h,this.sourceAngleData[o][1]])}this.datas=n}},t.prototype.getFeatureLabel=function(){var t=this.style.labelfield;return t&&this.attributes[t]?this.attributes[t]+"":null},t}();e.exports=i},{}],36:[function(t,e,r){var i=t("./GVMapGrid"),n=t("./draw/GVMapGridUtil"),o=t("../../ext/Version"),s=i.extend({styleObj:{},styleJs:null,initialize:function(t,e){e.isDynamicMap=!0,window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize&&(this.tilesize=e.tileSize),this.gVMapGridUtil=new n(e.isDynamicMap),this.gVMapGridUtil.tileSize=this.tilesize,this.gVMapGridUtil.parseUrl(t),this._url=t+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+o,L.setOptions(this,e),this.on("tileunload",this._onTileRemove),this.on("tileload",this._onTileLoad),this.on("tileerror",this._onTileError)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+o+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+o+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={},this.gVMapGridUtil.setStyle(this.styleObj);var t=this.gVMapGridUtil.loadStyle("layer");Promise.all(t).then(function(){this._resetView(),this._update()}.bind(this))},addLevels:function(t){this.styleObj[t.levelsKey]=t.levelsData},redraw:function(){return this.gVMapGridUtil.formatStyle(this.styleObj,function(){this._map&&(this._removeAllTiles(),this._update())}),this}});e.exports=s},{"../../ext/Version":10,"./GVMapGrid":37,"./draw/GVMapGridUtil":44}],37:[function(t,e,r){(function(r){(function(){var i=t("./../../utils/es6-promise"),n=i.getJSON,o=i.getBufferData,s=t("./draw/GVMapGridUtil"),a=t("./draw/DataHolder"),l=t("../../ext/Version"),h=t("./../label/VarintReader"),u=L.TileLayer.extend({urlArray:[],sourceUrl:null,textures:{},tileQueue:[],ratio:1,control:null,controlId:null,tilesize:512,initialize:function(t,e){window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize,this.gVMapGridUtil=new s,this.gVMapGridUtil.tileSize=this.tilesize,this.gVMapGridUtil.parseUrl(t),this._url=t+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+l,L.setOptions(this,e),this.on("tileunload",this._onTileRemove),this.on("tileload",this._onTileLoad),this.on("tileerror",this._onTileError)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+l+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+l+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={};var t=this.gVMapGridUtil.loadStyle("layer");Promise.all(t).then(function(){this._resetView(),this._update()}.bind(this))},createTile:function(t,e){var r=this.tileQueue.pop();r?this._cleanTile(r):r=this.initTile();var i=this.getTileUrl(t);return this.gVMapGridUtil.newEngine?o({url:i,dataType:"arraybuffer"}).then(function(t){var i=this.toBuffer(t.data),n={};if(i.length>0)for(var o=new h(i,4,this.gVMapGridUtil.layerFieldMap),s=o.getAllLayerNames(),a=0;a<s.length;a++){n[s[a]]={fieldsConfig:this.gVMapGridUtil.serverInfo[s[a]]?this.gVMapGridUtil.serverInfo[s[a]].fieldsConfig:{},features:[]};var l=o.getLayerPro(s[a]);if(l&&l[0])for(var u=0;u<l.length;u++){var c=[];c.push(o.getGeometryType(s[a])),c.push(l[u]),c.push(o.getCoordinatesByIndex(s[a],u,10)),n[s[a]].features.push(c)}}r.data=n,this._tileOnLoad.apply(this,[e,r])}.bind(this),function(t){this._tileOnError.apply(this,[e,r,t])}.bind(this)):n({url:i,dataType:"json"}).then(function(t){r.data=t,this._tileOnLoad.apply(this,[e,r])}.bind(this),function(t){this._tileOnError.apply(this,[e,r,t])}.bind(this)),r},toBuffer:function(t){for(var e=new r(t.byteLength),i=new Uint8Array(t),n=0;n<e.length;++n)e[n]=i[n];return e},Utf8ArrayToStr:function(t){var e,r,i,n,o,s;for(e="",i=t.length,r=0;r<i;)switch(n=t[r++],n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:o=t[r++],e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t[r++],s=t[r++],e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return e},getTileUrl:function(t){var e={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=r),e["-y"]=r}if(0==this.urlArray.length)return L.Util.template(this._url,L.extend(e,this.options));var i=this.urlArray.length-1,n=Math.round(Math.random()*i),o=this.urlArray[n],s=this._url.split("/mapserver"),a=s[1];return o=o+"/mapserver"+a,L.Util.template(o,L.extend(e,this.options))},initTile:function(){var t=document.createElement("canvas");t.style.width=this.tilesize+"px",t.style.height=this.tilesize+"px",t.width=this.tilesize,t.height=this.tilesize;var e=t.getContext("2d",{isQuality:!0});return t.ctx=e,t},_onTileRemove:function(t){this.tileQueue.push(t.tile)},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.complete||L.DomUtil.remove(e))},_onTileLoad:function(t){var e=t.tile
;this._drawTile(e,e.data),e.complete=!0},_onTileError:function(t){var e=t.tile;e.complete=!0,this.tileQueue.push(e)},_tileOnError:function(t,e,r){t(r,e)},_drawTile:function(t,e){var r=t.ctx,i=Math.floor(this._map.getZoom()),n=new a({layerDataMap:e,ctx:r,ratio:1,control:null,textures:this.gVMapGridUtil.textures,extent:{level:i}});this.gVMapGridUtil.styleFun.call({},n,i)},_cleanTile:function(t){t.ctx.clearRect(0,0,this.tilesize,this.tilesize)},_update:function(t){this.isSetIngFilter||L.TileLayer.prototype._update.call(this)},setFilter:function(t){if(this.isSetIngFilter=!0,!this._url||!t||0==t.layers.length&&0==t.order.length)return this.isSetIngFilter=!1,this.controlId=null,this.control=null,void this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+l);this.gVMapGridUtil.setFilter(t,function(t){this.isSetIngFilter=!1,t.isIE?(this.controlId=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+l+"&controlId="+t.id)):(this.control=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+l+"&control="+t.id))}.bind(this))},getFeatureByXY:function(t,e,r){var i=this._map.containerPointToLatLng(new L.point(t,e));this.getFeatureByLonlat(i,r)},getFeatureByLonlat:function(t,e){var r=this._map.options.crs.projection.bounds,i=this._map.getBounds(),n=this._map.getPixelBounds(),o=(i._northEast.lat-i._southWest.lat)/(n.max.y-n.min.y),s=this.options.tileSize,a=(r.max.y-t.lat)/(o*s),l=(t.lng-r.min.x)/(o*s),h=this._map.getZoom(),u=(l-Math.floor(l))*s,c=(a-Math.floor(a))*s;this.gVMapGridUtil.pickupFeatures(a,l,h,u,c,this.control,this.controlId,function(t){e(t)})},highlightFeatures:function(t,e){var r=this.gVMapGridUtil.CreateHighlightFilter(t,e);if(0!=r.layers.length){if(!this.highlightLayer){var i=this.gVMapGridUtil.host+"/mapserver/vmap/"+this.gVMapGridUtil.servername+"/getMAP?x={x}&y={y}&l={z}&styleId="+this.gVMapGridUtil.styleId;this.control&&(i=i+"&control="+this.control),this.controlId&&(i=i+"&controlId="+this.controlId),this.highlightLayer=new L.GXYZ(i,this.options),this._map.addLayer(this.highlightLayer)}this.highlightLayer.options.opacity=e.opacity,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(r);var n=this.options.zIndex;this.highlightLayer.setZIndex(n+1)}},highlightByFilter:function(t){if(0!=t.layers.length){if(!this.highlightLayer){var e=this.gVMapGridUtil.host+"/mapserver/vmap/"+this.gVMapGridUtil.servername+"/getMAP?x={x}&y={y}&l={z}&styleId="+this.gVMapGridUtil.styleId;this.control&&(e=e+"&control="+this.control),this.controlId&&(e=e+"&controlId="+this.controlId),this.highlightLayer=new L.GXYZ(e,this.options),this._map.addLayer(this.highlightLayer)}this.highlightLayer.options.opacity=1,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(t);var r=this.options.zIndex;this.highlightLayer.setZIndex(r+1)}},cancelHighlight:function(){this.highlightLayer&&(this._map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});e.exports=u}).call(this)}).call(this,t("buffer").Buffer)},{"../../ext/Version":10,"./../../utils/es6-promise":52,"./../label/VarintReader":22,"./draw/DataHolder":42,"./draw/GVMapGridUtil":44,buffer:2}],38:[function(t,e,r){var i=t("./draw/GXYZUtil"),n=t("../../ext/Version"),o=L.TileLayer.extend({urlArray:[],sourceUrl:null,gxyzUtil:null,highlightLayer:null,ratio:1,control:null,controlId:null,tilesize:512,initialize:function(t,e){window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize,this.gxyzUtil=new i,this.gxyzUtil.tileSize=this.tilesize,this.gxyzUtil.parseUrl(t),this._url=t+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+n,L.setOptions(this,e)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+n+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+n+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},_update:function(t){this.isSetIngFilter||L.TileLayer.prototype._update.call(this)},getTileUrl:function(t){var e={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=r),e["-y"]=r}if(0==this.urlArray.length)return L.Util.template(this._url,L.extend(e,this.options));var i=this.urlArray.length-1,n=Math.round(Math.random()*i),o=this.urlArray[n],s=this._url.split("/mapserver"),a=s[1];return o=o+"/mapserver"+a,L.Util.template(o,L.extend(e,this.options))},setFilter:function(t){if(this.isSetIngFilter=!0,!this._url||!t||0==t.layers.length&&0==t.order.length)return this.isSetIngFilter=!1,this.controlId=null,this.control=null,void this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+n);this.gxyzUtil.setFilter(t,function(t){this.isSetIngFilter=!1,t.isIE?(this.controlId=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+n+"&controlId="+t.id)):(this.control=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+n+"&control="+t.id))}.bind(this))},getFeatureByXY:function(t,e,r){var i=this._map.containerPointToLatLng(new L.point(t,e)),n=this._map.getZoom(),o=this._map.options.crs.project(i);this.gxyzUtil.pickupFeaturesBylatlng(n,this.control,this.controlId,o.y,o.x,r)},getFeatureByLonlat:function(t,e){var r=this._map.options.crs.projection.project(t),i=this._map.options.crs.projection.bounds,n=this._map.getBounds(),o=this._map.getPixelBounds(),s=this._map.options.crs.projection.project(n._northEast),a=this._map.options.crs.projection.project(n._southWest),l=(s.y-a.y)/(o.max.y-o.min.y),h=this.options.tileSize,u=(i.max.y-r.y)/(l*h),c=(r.x-i.min.x)/(l*h),f=this._map.getZoom(),p=(c-Math.floor(c))*h,d=(u-Math.floor(u))*h;this.gxyzUtil.pickupFeatures(u,c,f,p,d,this.control,this.controlId,function(t){e(t)})},highlightFeatures:function(t,e){var r=this.gxyzUtil.CreateHighlightFilter(t,e);if(0!=r.layers.length){this.highlightLayer||(this.highlightLayer=new L.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=e.opacity,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(r);var i=this.options.zIndex;this.highlightLayer.setZIndex(i+1)}},highlightEveryFeatures:function(t,e){var r=this.gxyzUtil.CreateEveryHighlightFilter(t);if(0!=r.layers.length){this.highlightLayer||(this.highlightLayer=new L.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=e,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(r);var i=this.options.zIndex;this.highlightLayer.setZIndex(i+1)}},highlightByFilter:function(t){if(0!=t.layers.length){this.highlightLayer||(this.highlightLayer=new L.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=1,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(t);var e=this.options.zIndex;this.highlightLayer.setZIndex(e+1)}},cancelHighlight:function(){this.highlightLayer&&(this._map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});e.exports=o},{"../../ext/Version":10,"./draw/GXYZUtil":45}],39:[function(t,e,r){var i=t("./PropertyGetter"),n=function(){function t(e,r){_classCallCheck(this,t),this.layerDataMap=e.layerDataMap,this.extent=e.extent,this.ctx=e.ctx,this.ratio=e.ratio,this.control=e.control,this.drawerCalss=r,this.config=e,this.textures=e.textures}return t.prototype._emptyDrawer=function(t){var e=new this.drawerCalss(null);return e},t.prototype.getLayer=function(t,e){if(null==e&&(e=t),null==this.layerDataMap)return this._emptyDrawer(e);if(null!=this.control&&0==this.control.controlObj.otherDisplay&&-1==this.control.controlObj.controlLayersArr.indexOf(e))return this._emptyDrawer(e);var r=this.layerDataMap[t];if(null==r)return this._emptyDrawer(e);if(r.datas&&(r.features=r.datas),null==r.features)return this._emptyDrawer(e);var n=null;null!==r.fieldsConfig&&(n=new i(r.fieldsConfig)),this.config.dataLayerID=t,this.config.styleLayerID=e,this.config.propertyGetter=n,this.config.control=this.control,this.config.textures=this.textures;var o=new this.drawerCalss(this.config);if(Array.isArray(r.features)){var s=r.features;s.type=r.type,o.addFeatures(s)}else for(var a in r.features){var l=r.features[a];l.type=r.type,o.addFeatures(l)}return o},t.prototype.getGroupLayer=function(t,e,r){if(null==this.layerDataMap)return this._emptyDrawer(r);if(null==r&&(r=t),null!=this.control&&0==this.control.controlObj.otherDisplay&&-1==this.control.controlObj.controlLayersArr.indexOf(r))return this._emptyDrawer(r);var n=this.layerDataMap[t];if(null==this.layerDataMap)return this._emptyDrawer(r);if(null==n)return this._emptyDrawer(r);if(null==n.datas&&null==n.data)return this._emptyDrawer(r);var o=e.split(","),s=o.length;if(0==s)return this._emptyDrawer(r);var a=null;null!=n.fieldsConfig&&(a=new i(n.fieldsConfig)),this.config.dataLayerID=t,this.config.styleLayerID=r,this.config.propertyGetter=a,this.config.control=this.control,this.config.textures=this.textures;var l=new this.drawerCalss(this.config);null==n.data?n.features=n.datas:n.features=n.data;for(var h=0;h<s;h++){var u=n.features[o[h]];null!=u&&(u.type=n.type,l.addFeatures(u))}return l},t}();e.exports=n},{"./PropertyGetter":46}],40:[function(t,e,r){var i=function(){function t(e){_classCallCheck(this,t),e&&(this.featuresArr=[],this.propertyGetter=e.propertyGetter,this.extent=e.extent,this.ratio=e.ratio,this.resize=!1,1!=this.ratio&&(this.resize=!0),this.level=this.extent.level,this.dataLayerID=e.dataLayerID,this.styleLayerID=e.styleLayerID,this.control=e.control)}return t.prototype.addFeatures=function(t){this.featuresArr.push(t)},t.prototype.setStyle=function(t){this.styleOperator=t},t.prototype.process=function(){if(null!=this.featuresArr){var t=this.featuresArr.length;if(0!=t)for(var e=0;e<t;e++){var r=this.featuresArr[e];this._processFeatures(r)}}},t.prototype._processFeature=function(t){throw"抽象方法"},t.prototype._processFeatures=function(t){for(var e=0;e<t.length;e++){var r=t[e];this._processFeature(r)}},t.prototype._getProperty=function(t){return t[1]},t.prototype._getPoints=function(t){return t[2]},t.prototype._getType=function(t){return t[0]},t.prototype._filterByStyle=function(t){var e=this._getType(t),r=this._getPoints(t),i=this._getProperty(t);if(null==r)throw"绘制失败,数据中缺少Geometry";null==e&&(e="POLYGON");var n=null,o=null;if(null==this.styleOperator)return null;this.propertyGetter;var s=this.propertyGetter.getId(i),a=this.propertyGetter,l=function(t){return a.get(i,t)};return this.control&&"function"==typeof this.control.controlFn&&(n=this.control.controlFn.call({},s,l,this.styleLayerID),0==n||null==n)?{display:!1}:(o=this.styleOperator.call({},this.level,l),null==o?null:null!=o.display&&0==o.display?{display:!1}:(null!=n&&(o.customeColor=n),o))},t}();e.exports=i},{}],41:[function(t,e,r){var i=function(){function t(e){_classCallCheck(this,t),this.ratio=e.ratio,this.datasArr=[],this.ctx=e.ctx,this.extent=e.extent,this.control=e.control,this.styleFn=null,this.drawable=!1}return t.prototype.getName=function(){return this.name},t.prototype.setStyle=function(t){this.styleFn=t},t.prototype.draw=function(){this.drawable=!0,this.doDraw()},t.prototype.doDraw=function(t){},t}();e.exports=i},{}],42:[function(t,e,r){var i=t("./AbstractDataHolder"),n=t("./Drawer"),o=t("./BackgroundDrawer"),s=function(t){function e(r){return _classCallCheck(this,e),_possibleConstructorReturn(this,t.call(this,r,n))}return _inherits(e,t),e.prototype.getBackground=function(){var t=new o({extent:this.extent,ctx:this.ctx,control:this.control,ratio:this.ratio});return t},e.prototype.getWatermark=function(){},e}(i);e.exports=s},{"./AbstractDataHolder":39,"./BackgroundDrawer":41,"./Drawer":43}],43:[function(t,e,r){var i=t("./AbstractVTileProcess"),n=function(t){function e(r){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this,r));return r&&(i.ctx=r.ctx,i.shadowDatas=[],i.textures=r.textures),i}return _inherits(e,t),e.prototype.draw=function(){if(null!=this.featuresArr){this.process();for(var t=0;t<this.shadowDatas.length;t++){var e=this.shadowDatas[t];this._drawShape(e.data),this._processShadowEnd(e.style)}}},e.prototype._processShadowEnd=function(t){this.ctx.closePath(),t.shadowColor&&(this.ctx.globalAlpha=1,this.ctx.fillStyle=t.shadowColor,this.ctx.fill())},e.prototype._drawShape=function(t){var e=this.ctx;if(t.length){if(e.beginPath(),this.resize){e.moveTo(t[0]*this.ratio,t[1]*this.ratio);for(var r=2,i=t.length;r<i;r+=2)e.lineTo(t[r]*this.ratio,t[r+1]*this.ratio)}else{e.moveTo(t[0],t[1]);for(r=2,i=t.length;r<i;r+=2)e.lineTo(t[r],t[r+1])}e.closePath()}},e.prototype._processFeature=function(t){var e=this._filterByStyle(t);null!=e&&0!=e.display&&(this._beginDraw(),this._drawFeature(t,e))},e.prototype._beginDraw=function(){this.ctx.beginPath()},e.prototype._drawFeature=function(t,e){var r=this._getType(t),i=this._getPoints(t);this._getProperty(t);if(null==i)throw"绘制失败,数据中缺少Geometry";null==r&&(r="POLYGON");var n=null;switch(null==e.sparsity||(n=parseFloat(e.sparsity)),r){case"PT":this._processPoint(i);break;case"LINESTRING":case"MULTILINESTRING":this._processLineString(i,n),this._processLineStringEnd(e);break;case"MULTIPOLYGON":case"POLYGON":this._processPolygon(i,n),this._processPolygonEnd(e)}e.shadowColor&&this._processShadow(i,e,r)},e.prototype._processShadow=function(t,e,r){for(var i=t.length,n=0;n<i;n++){var o=t[n];if(Array.isArray(o)){if(0==o.length)return;Array.isArray(o[0])?this._processShadow(o):this._drawShadow(o,e,r)}else{var s=o.PS;this._drawShadow(s,e,r)}}},e.prototype._drawShadow=function(t,e,r){var i=-3.5;if("MULTIPOLYGON"==r||"POLYGON"==r)for(var n=0;n<t.length-3;n+=2){var o={},s={};o.x=t[n],o.y=t[n+1],s.x=t[n+2],s.y=t[n+3];var a=o.x,l=o.y+i,h=s.x,u=s.y+i;if((h-a)*(o.y-l)<(o.x-a)*(u-l)){var c={};c.data=[h,u,a,l,o.x,o.y,s.x,s.y],c.style=e,this.shadowDatas.push(c)}}},e.prototype._processPoint=function(t){},e.prototype._processLineString=function(t,e){if(Array.isArray(t[0]))for(var r=t.length,i=0;i<r;i++){var n=t[i];this._processLineString(n,e)}else this._renderLinePath(t,!1,e)},e.prototype._processLineStringEnd=function(t){var e=!0;if(0==t.stroke&&(e=!1),0!=e){this.resize?this.ctx.lineWidth=t.strokeWidth*this.ratio:this.ctx.lineWidth=t.strokeWidth,this.ctx.strokeStyle=t.strokeColor,this.ctx.globalAlpha=t.strokeOpacity,null!=t.dash&&t.dash instanceof Array&&this.ctx.setLineDash(t.dash),t.lineCap&&(this.ctx.lineCap=t.lineCap),this.ctx.stroke();var r=t.customeColor;"object"==(void 0===r?"undefined":_typeof(r))&&null!=r.color&&(this.ctx.strokeStyle=r.color,this.ctx.globalAlpha=r.opacity,this.ctx.stroke()),this.ctx.setLineDash([]),this.ctx.lineJoin="round",this.ctx.lineCap="butt"}},e.prototype._processPolygon=function(t,e){if(Array.isArray(t[0]))for(var r=t.length,i=0;i<r;i++){var n=t[i];this._processPolygon(n,e)}else this._renderLinePath(t,!0,e)},e.prototype._processPolygonEnd=function(t){var e=!1,r=!1;if(1==t.stroke&&(e=!0),1==t.fill&&(r=!0),r&&(t.fillColor&&(this.ctx.fillStyle=t.fillColor),t.fillOpacity||0==t.fillOpacity?this.ctx.globalAlpha=t.fillOpacity:this.ctx.globalAlpha=1,this.ctx.fill()),e&&(t.strokeWidth&&(this.resize?this.ctx.lineWidth=t.strokeWidth*this.ratio:this.ctx.lineWidth=t.strokeWidth),t.strokeColor&&(this.ctx.strokeStyle=t.strokeColor),t.strokeOpacity?this.ctx.globalAlpha=t.strokeOpacity:this.ctx.globalAlpha=1,this.ctx.stroke()),t.texture){var i=t.texture,n=this.textures(i);if(null!=n){var o=t.textureratio,s=this.ctx.createPattern(n.toPattern(o),"repeat");this.ctx.fillStyle=s,this.ctx.fill()}}var a=t.customeColor;"object"==(void 0===a?"undefined":_typeof(a))&&null!=a.color&&(this.ctx.fillStyle=a.color,this.ctx.globalAlpha=a.opacity,this.ctx.fill())},e.prototype._isSavePoint=function(t,e,r,i){if(null==t||null==r)return!0;var n=e[0]-t[0],o=e[1]-t[1],s=r[0]-e[0],a=r[1]-e[1];return!(Math.sqrt(n*n+o*o)<i&&Math.sqrt(s*s+a*a)<i)},e.prototype._renderLinePath=function(t,e,r){this.resize?this.ctx.moveTo(t[0]*this.ratio,t[1]*this.ratio):this.ctx.moveTo(t[0],t[1]);var i=2,n=t.length;n%2!=0&&(n-=1);for(var o=[t[0],t[1]],s=null,a=null;i<n;){var l=0;if(s=[t[i],t[i+1]],null!=r)for(a=i+2>n?null:[t[i+2],t[i+3]];!this._isSavePoint(o,s,a,r*this.ratio);)l+=2,s=[t[i+l],t[i+1+l]],a=i+2+l>n?null:[t[i+2+l],t[i+3+l]];this.resize?this.ctx.lineTo(s[0]*this.ratio,s[1]*this.ratio):this.ctx.lineTo(s[0],s[1]),o=s,i=i+l+2}e&&(this.resize?this.ctx.lineTo(t[0]*this.ratio,t[1]*this.ratio):this.ctx.lineTo(t[0],t[1]),this.ctx.closePath())},e}(i);e.exports=n},{"./AbstractVTileProcess":40}],44:[function(t,e,r){var i=t("./GXYZUtil"),n=t("./../../../utils/es6-promise"),o=n.Deferred,s=n.getJSON,a=n.getBufferData,l=t("./../../../utils/gistools/GisTools"),h=t("snappyjs"),u=function(t){function e(r){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,t.call(this));return i.textures={},i.isDynamicMap=r,i.styleObj={},i.newEngine=!1,i.layerFieldMap={},i.serverInfo={},i.isLoadServerInfoDef=new o,i}return _inherits(e,t),e.prototype.setStyle=function(t){this.styleObj=t},e.prototype.formatStyle=function(t,e){this.styleObj=t;var r=JSON.stringify(this.styleObj);s({type:"post",url:this.host+"/mapserver/styleInfo/format.do",data:"styleJson= "+r,dataType:"json"}).then(function(t){this.styleFun=new Function("drawer","level",t.styleJs),e()}.bind(this))},e.prototype.loadStyle=function(t){var e=this,r=new o,i=new o;return this.loadServerInfo(),this.isLoadServerInfoDef.then(function(){if(t||(t="label"),e.isDynamicMap){var n=JSON.stringify(e.styleObj);s({type:"post",url:"http://127.0.0.1/mapserver/styleInfo/format.do",data:"styleJson= "+n,dataType:"json"}).then(function(t){this.styleFun=new Function("drawer","level",t.styleJs),r.resolve()}.bind(e))}else L.gipStyle?a({url:e.host+"/mapserver/styleInfo/"+e.servername+"/"+e.styleId+"/"+t+"/style.snappy?"+Math.random(),dataType:"arraybuffer"}).then(function(t){var e=l.toBuffer(t.data),i=l.Utf8ArrayToStr(h.uncompress(e));this.newEngine?this.styleFun=new Function("render","level",i):this.styleFun=new Function("drawer","level",i),r.resolve()}.bind(e)):s({url:e.host+"/mapserver/styleInfo/"+e.servername+"/"+e.styleId+"/"+t+"/style.js?"+Math.random(),dataType:"text"}).then(function(t){this.newEngine?this.styleFun=new Function("render","level",t):this.styleFun=new Function("drawer","level",t),r.resolve()}.bind(e));s({url:e.host+"/mapserver/styleInfo/"+e.servername+"/"+e.styleId+"/label/texture.js?"+Math.random(),dataType:"text"}).then(function(t){var e=JSON.parse(t),r=0;for(var n in e)r++;if(0!=r){var o=0;for(var s in e){var a=new Image;a.name=s,a.onload=function(t){o++;var e=t.target.name;this.textures[e]=t.target,o==r&&i.resolve()}.bind(this),a.src=e[s]}}else i.resolve()}.bind(e))}),[r,i]},e.prototype.loadServerInfo=function(){var t=this;this.host&&this.servername&&s({type:"get",url:this.host+"/mapserver/serverInfo/"+this.servername+".json",dataType:"json"}).then(function(e){if(e)if(e.layerMap)for(var r in t.newEngine=!0,e.layerMap)t.serverInfo[r]={geometryType:e.layerMap[r].geometryType,fieldsConfig:e.layerMap[r].fields},t.layerFieldMap[r]||(t.layerFieldMap[r]=e.layerMap[r].fields.length);else t.newEngine=!1;t.isLoadServerInfoDef.resolve()},function(e){t.isLoadServerInfoDef.resolve()})},e}(i);e.exports=u},{"./../../../utils/es6-promise":52,"./../../../utils/gistools/GisTools":54,"./GXYZUtil":45,snappyjs:5}],45:[function(t,e,r){var i=t("./../../../utils/es6-promise"),n=i.getJSON,o=t("./../../../filter/Filter"),s=t("./../../../filter/FilterLayer"),a=t("../../../ext/Version"),l=function(){function t(){_classCallCheck(this,t),this.tileSize=256}return t.prototype.setFilter=function(t,e){for(var r=0;r<t.layers.length;r++){var i=t.layers[r];i.id||t.layers.splice(r,1)}var o=JSON.stringify(t);if(this.isIE())n({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control= "+o,dataType:"json"}).then(function(t){t.isIE=!0,e(t)}.bind(this));else{var s={isIE:!1,id:encodeURIComponent(o)};e(s)}},t.prototype.parseUrl=function(t){var e=t.split("?"),r=e[0].split("/mapserver/");this.host=r[0],this.servername=r[1].split("/")[1];for(var i=e[1].split("&"),n=0;n<i.length;n++){var o=i[n],s=o.split("=");"styleId"==s[0]&&(this.styleId=s[1]),"newEngine"==s[0]&&(this.newEngine=s[1])}},t.prototype.pickupFeaturesBylatlng=function(t,e,r,i,o,s){var l=this.host+"/mapserver/"+this.servername+"/"+this.styleId+"/pickup?level="+t+"&lon="+o+"&lat="+i+"&clientVersion="+a;e&&(l=l+"&control="+e),r&&(l=l+"&controlId="+r),n({url:l,dataType:"json"}).then(function(t){s(t)},function(){s([])})},t.prototype.pickupFeatures=function(t,e,r,i,o,s,l,h){var u=this.host+"/mapserver/pickup/"+this.servername+"/getData?x="+e+"&y="+t+"&l="+r+"&pixelX="+i+"&pixelY="+o+"&styleId="+this.styleId+"&tilesize="+this.tileSize+"&clientVersion="+a;s&&(u=u+"&control="+s),l&&(u=u+"&controlId="+l),n({url:u,dataType:"json"}).then(function(t){h(t)},function(){h([])})},t.prototype.CreateHighlightFilter=function(t,e){var r=new o;for(var i in r.otherDisplay=!1,t){var n=t[i],a=new s;a.id=i,a.color=e;var l="";for(var h in n)l=l+h+",";l.length>0&&(l=l.substr(0,l.length-1),a.idFilter=l),r.addFilterLayer(a)}return r},t.prototype.CreateEveryHighlightFilter=function(t){var e=new o;for(var r in e.otherDisplay=!1,t){var i=t[r],n=i.style,a=!1;for(var l in i){var h=i[l].style,u=new s;u.id=r,u.idFilter=l,u.color=h,e.addFilterLayer(u),a=!0}if(!a&&n){u=new s;u.id=r,u.color=n,e.addFilterLayer(u)}}return e},t.prototype.isIE=function(){if(window.ActiveXObject||"ActiveXObject"in window){var t=navigator.appVersion,e=t.split(";");if(e[1]){var r=e[1].replace(/[ ]/g,"");if("MSIE9.0"==r)return!1}return!0}return!1},t}();e.exports=l},{"../../../ext/Version":10,"./../../../filter/Filter":11,"./../../../filter/FilterLayer":12,"./../../../utils/es6-promise":52}],46:[function(t,e,r){var i=function(){function t(e){_classCallCheck(this,t),this.propertyConfig={};for(var r=0;r<e.length;r++)"true"!=e[r].id&&1!=e[r].id||(this.idIndex=e[r].index),this.propertyConfig[e[r].name]=parseInt(e[r].index)}return t.prototype.get=function(t,e){var r=t[this.propertyConfig[e]];return r},t.prototype.getId=function(t){return t[this.idIndex]},t}();e.exports=i},{}],47:[function(t,e,r){var i=function(){function t(e){_classCallCheck(this,t),this.group={},this.group.id=e,this.group.type="group",this.group.children=[]}return t.prototype.addStyle=function(t){this.group.children.push(t.style)},t}();e.exports=i},{}],48:[function(t,e,r){var i=function(){function t(e,r){_classCallCheck(this,t),this.levelsData=[],this.levelsKey=e+"-"+r}return t.prototype.addGroup=function(t){this.levelsData.push(t.group)},t.prototype.addStyleItem=function(t){this.levelsData.push(t.style)},t}();e.exports=i},{}],49:[function(t,e,r){var i=function(){function t(e,r){_classCallCheck(this,t),this.style={},this.style.id=e,this.style.layer=r,this.style.type="style",this.style.children=[]}return t.prototype.queryFilter=function(t,e){t?(this.style.query=t,this.style.fields=e):this.style.query=""},t.prototype.setStyle=function(t){this.style.style=t},t.prototype.addSubStyle=function(t){this.style.children.push(t.style)},t}();e.exports=i},{}],50:[function(t,e,r){var i=function(){function t(e){_classCallCheck(this,t),this.size=e,this.map={},this.list=[]}return t.prototype.push=function(t,e){if(this.list.length>this.size-1){var r=this.list.shift();delete this.map[r]}this.list.push(t),this.map[t]=e},t.prototype.getItem=function(t){return this.map[t]},t.prototype.clean=function(){this.map={},this.list=[]},t.prototype.length=function(){return this.list.length},t}();e.exports=i},{}],51:[function(t,e,r){function i(){this.id=this.createUUID()}i.prototype.valueOf=function(){return this.id},i.prototype.toString=function(){return this.id},i.prototype.createUUID=function(){var t=new Date(1582,10,15,0,0,0,0),e=new Date,r=e.getTime()-t.getTime(),n=i.getIntegerBits(r,0,31),o=i.getIntegerBits(r,32,47),s=i.getIntegerBits(r,48,59)+"2",a=i.getIntegerBits(i.rand(4095),0,7),l=i.getIntegerBits(i.rand(4095),0,7),h=i.getIntegerBits(i.rand(8191),0,7)+i.getIntegerBits(i.rand(8191),8,15)+i.getIntegerBits(i.rand(8191),0,7)+i.getIntegerBits(i.rand(8191),8,15)+i.getIntegerBits(i.rand(8191),0,15);return n+o+s+a+l+h},i.getIntegerBits=function(t,e,r){var n=i.returnBase(t,16),o=new Array,s="",a=0;for(a=0;a<n.length;a++)o.push(n.substring(a,a+1));for(a=Math.floor(e/4);a<=Math.floor(r/4);a++)o[a]&&""!=o[a]?s+=o[a]:s+="0";return s},i.returnBase=function(t,e){var r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];if(t<e)var i=r[t];else{var n=""+Math.floor(t/e),o=t-n*e;if(n>=e)i=this.returnBase(n,e)+r[o];else i=r[n]+r[o]}return i},i.rand=function(t){return Math.floor(Math.random()*t)},e.exports=i},{}],52:[function(t,e,r){var i=t("./jx"),n=t("../layer/label/avoid/ParseLabelData"),o=(n.parseMultiLine,function(){this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this)),this.then=this.promise.then.bind(this.promise),this.catch=this.promise.catch.bind(this.promise)}),s=function(t){return t.type||(t.type="GET"),t.dataType||(t.dataType="json"),new Promise(function(e,r){l(e,r,t)})},a=function(t){var e;t.type||(t.type="GET"),t.dataType||(t.dataType="arraybuffer");var r=new Promise(function(r,i){e=l(r,i,t,!0)});return r.xhr=e,r},l=function(t,e,r,n){var o,s=r.type.toUpperCase();"GET"==s&&(o=i.get(r.url)),"POST"==s&&(o=i.post(r.url,r.data)),"arraybuffer"==r.dataType&&(o=i.get(r.url,!0));var a=3e4,l=!1;setTimeout(function(){(o.request.status>=300||o.request.status<200)&&(l=!0,o.request.abort(),console.warn("timeout: "+r.url),e({param:r,data:"getParamJSON: "+r.url+" timeout "}))},a);return o.success(function(e,i){l||("json"==r.dataType&&"string"==typeof e&&(e=JSON.parse(e)),t(n?{param:r,data:e}:e))}),o.error(function(t,i){l||e({param:r,data:"getParamJSON: "+r.url+" failed with status: "+i.status})}),o.request},h=function(t){var e;t.type||(t.type="GET"),t.dataType||(t.dataType="json");var r=new Promise(function(r,i){e=l(r,i,t,!0)});return r.xhr=e,r};e.exports={Deferred:o,getJSON:s,getParamJSON:h,getBufferData:a}},{"../layer/label/avoid/ParseLabelData":31,"./jx":56}],53:[function(t,e,r){var i=1,n=2,o=3,s=4,a=5,l=6,h=7,u=8,c=9,f=1,p=2,d=function(){function t(e,r,i,n,o,s){_classCallCheck(this,t),null==s&&(s=5);var a=5*o/100;this.left=e-a,this.right=r+a,this.bottom=i-a,this.top=n+a,this.previous=t.createEmptyDoubleArray(),this.now=t.createEmptyDoubleArray(),this.question=t.createEmptyDoubleArray(),this.point_previous_quadrant=-1,this.point_now_quadrant=-1,this.point_question_quadrant=-1}return t.createEmptyDoubleArray=function(){return[NaN,NaN]},t.prototype.copy=function(t,e){e[0]=t[0],e[1]=t[1]},t.isEmpty=function(t){return null==t||!(!isNaN(t[0])&&!isNaN(t[1]))},t.prototype.isQuadrant=function(t){var e=t[0],r=t[1];return e<this.left?r>this.top?u:r<this.bottom?n:i:e>this.right?r>this.top?l:r<this.bottom?s:a:r>this.top?h:r<this.bottom?o:c},t.prototype.passrule=function(t,e){return 1==t?1==e||2==e||8==e?p:f:2==t?1==e||2==e||8==e||3==e||4==e?p:f:3==this.point_previous_quadrant?2==this.point_now_quadrant||3==this.point_now_quadrant||4==this.point_now_quadrant?p:f:4==t?2==e||3==e||4==e||5==e||6==e?p:f:5==t?4==e||5==e||6==e?p:f:6==t?4==e||5==e||6==e||7==e||8==e?p:f:7==t?6==e||7==e||8==e?p:f:8==t&&(6==e||7==e||8==e||1==e||2==e)?p:f},t.prototype.reset=function(){this.previous[0]=NaN,this.previous[1]=NaN,this.question[0]=NaN,this.question[1]=NaN,this.now[0]=NaN,this.now[1]=NaN,this.point_previous_quadrant=-1,this.point_now_quadrant=-1,this.point_question_quadrant=-1},t.prototype.in=function(t){return!(t[0]<this.left||t[0]>this.right)&&!(t[1]<this.bottom||t[1]>this.top)},t.length=function(t,e,r,i){var n=r-t,o=i-e,s=Math.sqrt(n*n+o*o);return s},t.prototype.push=function(e,r){if(this.now[0]=e,this.now[1]=r,t.isEmpty(this.previous))return this.copy(this.now,this.previous),this.point_previous_quadrant=this.isQuadrant(this.now),[this.now];this.point_now_quadrant=this.isQuadrant(this.now);var i=this.passrule(this.point_previous_quadrant,this.point_now_quadrant);if(i==f){if(this.point_previous_quadrant=this.isQuadrant(this.now),this.copy(this.now,this.previous),t.isEmpty(this.question))return[this.now];var n=[];return this.copy(this.question,n),this.question=t.createEmptyDoubleArray(),[n,this.now]}if(i==p){if(!t.isEmpty(this.question)&&(i=this.passrule(this.point_question_quadrant,this.point_now_quadrant),i==f)){var o=[];return this.copy(this.question,o),this.question=t.createEmptyDoubleArray(),[o,this.now]}return this.copy(this.now,this.question),this.point_question_quadrant=this.point_now_quadrant,null}return null},t}();e.exports=d},{}],54:[function(t,e,r){(function(t){(function(){var r=5,i=function(){function e(){_classCallCheck(this,e)}return e.pointDistToLine=function(t,e,r,i,n,o){var s=(r-n)*(r-n)+(i-o)*(i-o),a=(t-r)*(n-r)+(e-i)*(o-i),l=a/s,h=r+l*(n-r),u=i+l*(o-i),c=Math.sqrt((t-h)*(t-h)+(e-u)*(e-u));return c},e.isPointOnSegment=function(t,i,n,o,s,a){if(t-r>n&&t+r>s||t+r<n&&t-r<s)return 0;if(i-r>o&&i+r>a||i+r<o&&i-r<a)return 0;var l=e.pointDistToLine(t,i,n,o,s,a);return l<r?1:0},e.pointInLine=function(t,r,i){var n=[];Array.isArray(i[0])?n=i:n.push(i);for(var o=0;o<n.length;o++)for(var s=n[o],a=s.length/2,l=0;l<a-1;l++){var h=void 0;h=l+1;var u=s[2*l],c=s[2*l+1],f=s[2*h],p=s[2*h+1];if(1==e.isPointOnSegment(t,r,u,c,f,p))return 1}return 0},e.pointInPolygon=function(t,e,r){var i=0,n=[];Array.isArray(r[0])?n=r:n.push(r);for(var o=0;o<n.length;o++)for(var s=n[o],a=s.length/2,l=0,h=a,u=h-1;l<h;u=l,l++){var c=s[2*l],f=s[2*l+1],p=s[2*u],d=s[2*u+1];if(c===t&&f===e||p===t&&d===e)return 1;if(f<e&&d>=e||f>=e&&d<e){var y=c+(e-f)*(p-c)/(d-f);if(y===t)return 1;y>t&&(i=!i)}}return i?1:0},e.lineIntersects=function(t,e,r,i,n,o,s,a){var l,h,u,c,f,p=[null,null];return l=(a-o)*(r-t)-(s-n)*(i-e),0===l?null!==p[0]&&null!==p[1]&&p:(h=e-o,u=t-n,c=(s-n)*h-(a-o)*u,f=(r-t)*h-(i-e)*u,h=c/l,u=f/l,p[0]=t+h*(r-t),p[1]=e+h*(i-e),u>0&&u<1&&p)},e.polyWith=function(t,r){for(var i=t.length/2,n=r.length/2,o=void 0,s=void 0,a=void 0,l=void 0,h=void 0,u=void 0,c=void 0,f=void 0,p=0;p<i;p++){p!=i-1?(s=t[2*p],a=t[2*p+1],l=t[2*p+2],o=t[2*p+3]):(s=t[2*p],a=t[2*p+1],l=t[0],o=t[1]);for(var d=0;d<n;d++)if(d!=n-1?(u=r[2*d],c=r[2*d+1],f=r[2*d+2],h=r[2*d+3]):(u=r[2*d],c=r[2*d+1],f=r[0],h=r[1]),0!=e.lineIntersects(s,a,l,o,u,c,f,h))return 1}var y=r[0],g=r[1];return e.pointInPolygon(y,g,t)?2:3},e.boxToPolyArr=function(t,e,r,i){var n=[];return n.push(t),n.push(e),n.push(t),n.push(i),n.push(r),n.push(i),n.push(r),n.push(e),n.push(t),n.push(e),n},e.getExtensionPoint=function(t,e,r){var i=e[0]-t[0],n=e[1]-t[1],o=e[0],s=e[1];if(0==i)s=n>0?e[1]+r:e[1]-r;else{var a=Math.sqrt(r*r/(n/i*(n/i)+1));i<0&&(a=-a),o=e[0]+a,s=e[1]+n/i*a}return[o,s]},e.lineOffset=function(t,r){var i=[],n=[];return t.forEach(function(o,s){if(s!==t.length-1){var a=e.processSegment(o,t[s+1],r);if(i.push(a),s>0){var l=i[s-1],h=e.lineIntersects(a[0][0],a[0][1],a[1][0],a[1][1],l[0][0],l[0][1],l[1][0],l[1][1]);!1!==h&&(l[1]=h,a[0]=h),n.push(l[0]),s===t.length-2&&(n.push(a[0]),n.push(a[1]))}2===t.length&&(n.push(a[0]),n.push(a[1]))}}),n},e.processSegment=function(t,e,r){var i=t[0],n=e[0],o=Math.sqrt((i[0]-n[0])*(i[0]-n[0])+(i[1]-n[1])*(i[1]-n[1])),s=i[0]+r*(n[1]-i[1])/o,a=n[0]+r*(n[1]-i[1])/o,l=i[1]+r*(i[0]-n[0])/o,h=n[1]+r*(i[0]-n[0])/o;return[[[s,l],t[1]],[[a,h],e[1]]]},e.isInBox=function(t,e){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]<=e[2]&&t[3]<=e[3]},e.Utf8ArrayToStr=function(t){var e,r,i,n,o,s;for(e="",i=t.length,r=0;r<i;)switch(n=t[r++],n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:o=t[r++],e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:
o=t[r++],s=t[r++],e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return e},e.toBuffer=function(e){for(var r=new t(e.byteLength),i=new Uint8Array(e),n=0;n<r.length;++n)r[n]=i[n];return r},e}();e.exports=i}).call(this)}).call(this,t("buffer").Buffer)},{buffer:2}],55:[function(t,e,r){var i=function(){function t(e,r,i,n){_classCallCheck(this,t);var o=e/r,s=i/r;this.maxPerCell=null==n?1:n,this.cells={},this.d=o+2*s,this.n=o,this.padding=s,this.scale=o/e;var a=s/o*e;this.min=-a,this.max=e+a}return t.prototype.filter=function(t,e){if(t<this.min||t>this.max||e<this.min||e>this.max)return!1;var r=this.convertToCellCoord(t),i=this.convertToCellCoord(e),n=this.d*i+r;if(this.cells[n]>=this.maxPerCell)return!1;var o=this.cells[n];return this.cells[n]=null==o?1:o++,!0},t.prototype.filterByBox=function(t){for(var e=this.convertToCellCoord(t[0]),r=this.convertToCellCoord(t[2]),i=this.convertToCellCoord(t[1]),n=this.convertToCellCoord(t[3]),o=e;o<=r;o++)for(var s=i;s<=n;s++){var a=this.d*s+o;if(this.cells[a])return!1}for(var l=e;l<=r;l++)for(var h=i;h<=n;h++){var u=this.d*h+l;this.cells[u]=1}return!0},t.prototype.clean=function(){this.cells={},this.saveCount=0},t.prototype.convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},t}();e.exports=i},{}],56:[function(e,r,i){(function(n){(function(){!function(e){if("object"==(void 0===i?"undefined":_typeof(i))&&void 0!==r)r.exports=e();else if("function"==typeof t&&t.amd)t([],e);else{var o;"undefined"!=typeof window?o=window:void 0!==n?o=n:"undefined"!=typeof self&&(o=self),o.jx=e()}}(function(){return function t(r,i,n){function o(a,l){if(!i[a]){if(!r[a]){var h="function"==typeof e&&e;if(!l&&h)return h(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};r[a][0].call(c.exports,function(t){var e=r[a][1][t];return o(e||t)},c,c.exports,t,r,i,n)}return i[a].exports}for(var s="function"==typeof e&&e,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,r){function i(t,e,r){t.setRequestHeader(e,r)}function n(){}function o(t,e,r,o,l){var h,u={success:n,error:n};if(!s){var c=navigator.appVersion,f=c.split(";");if(f[1]){var p=f[1].replace(/[ ]/g,"");a="MSIE9.0"==p}s=!0}h=a?new XDomainRequest:window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),l&&(h.responseType="arraybuffer");var d="POST"===e||"PATCH"===e||"DELETE"===e;h.open(e,t,!0),a||(r?(i(h,"Content-Type","application/json"),i(h,"Accept","application/json")):l||i(h,"Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),d&&r&&(o=JSON.stringify(o)),h.onreadystatechange=function(){4===h.readyState&&(h.status>=200&&h.status<300?l?u.success.call(h,h.response,h):u.success.call(h,h.responseText,h):"arraybuffer"==h.responseType?u.error.call(h,h.response,h):u.error.call(h,h.responseText,h))},h.onerror=function(){l?u.error.call(h,h.statusText,h):u.error.call(h,h.responseText,h)},h.onload=function(){l?u.success.call(h,h.response,h):u.success.call(h,h.responseText,h)},d?h.send(o):h.send();var y={success:function(t){return u.success=t,y},error:function(t){return u.error=t,y},request:h};return y}var s=!1,a=!1;e.exports={get:function(t,e){return o(t,"GET",!1,null,e)},post:function(t,e){return o(t,"POST",!1,e)},patch:function(t,e){return o(t,"PATCH",!1,e)},delete:function(t){return o(t,"DELETE",!1,null)},json:{get:function(t){return o(t,"GET",!0,null)},post:function(t,e){return o(t,"POST",!0,e)},patch:function(t,e){return o(t,"PATCH",!0,e)}}}},{}]},{},[1])(1)})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[13])(13)});